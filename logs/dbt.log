[0m13:00:08.509766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a8f6c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a907b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a907f90>]}


============================== 13:00:08.513366 | a12ce8ef-abfc-47ba-9894-91e725b4126b ==============================
[0m13:00:08.513366 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:00:08.513675 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m13:00:08.522570 [info ] [MainThread]: dbt version: 1.9.2
[0m13:00:08.522921 [info ] [MainThread]: python version: 3.11.4
[0m13:00:08.523097 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11
[0m13:00:08.523242 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit
[0m13:00:09.490415 [info ] [MainThread]: Using profiles dir at /Users/edou/.dbt
[0m13:00:09.490774 [info ] [MainThread]: Using profiles.yml file at /Users/edou/.dbt/profiles.yml
[0m13:00:09.490933 [info ] [MainThread]: Using dbt_project.yml file at /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/dbt_project.yml
[0m13:00:09.491080 [info ] [MainThread]: adapter type: bigquery
[0m13:00:09.491274 [info ] [MainThread]: adapter version: 1.9.1
[0m13:00:09.543028 [info ] [MainThread]: Configuration:
[0m13:00:09.543379 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:00:09.543534 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:00:09.543667 [info ] [MainThread]: Required dependencies:
[0m13:00:09.543859 [debug] [MainThread]: Executing "git --help"
[0m13:00:09.567959 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:00:09.568625 [debug] [MainThread]: STDERR: "b''"
[0m13:00:09.568834 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:00:09.569007 [info ] [MainThread]: Connection:
[0m13:00:09.569250 [info ] [MainThread]:   method: oauth
[0m13:00:09.569382 [info ] [MainThread]:   database: salesanalysis-450811
[0m13:00:09.569505 [info ] [MainThread]:   execution_project: salesanalysis-450811
[0m13:00:09.569629 [info ] [MainThread]:   schema: sales_analysis
[0m13:00:09.569747 [info ] [MainThread]:   location: EU
[0m13:00:09.569866 [info ] [MainThread]:   priority: interactive
[0m13:00:09.569989 [info ] [MainThread]:   maximum_bytes_billed: None
[0m13:00:09.570107 [info ] [MainThread]:   impersonate_service_account: None
[0m13:00:09.570225 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m13:00:09.570339 [info ] [MainThread]:   job_retries: 1
[0m13:00:09.570461 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m13:00:09.570577 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m13:00:09.570698 [info ] [MainThread]:   timeout_seconds: 300
[0m13:00:09.570815 [info ] [MainThread]:   client_id: None
[0m13:00:09.570937 [info ] [MainThread]:   token_uri: None
[0m13:00:09.571051 [info ] [MainThread]:   dataproc_region: None
[0m13:00:09.571168 [info ] [MainThread]:   dataproc_cluster_name: None
[0m13:00:09.571280 [info ] [MainThread]:   gcs_bucket: None
[0m13:00:09.571395 [info ] [MainThread]:   dataproc_batch: None
[0m13:00:09.571713 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:00:09.658030 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m13:00:09.658432 [debug] [MainThread]: On debug: select 1 as id
[0m13:00:09.658612 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:00:21.457218 [debug] [MainThread]: BigQuery adapter: Got an error when attempting to create a bigquery " "client: 'Runtime Error
  Failed to authenticate with supplied credentials
  error:
  Your default credentials were not found. To set up Application Default Credentials, see https://cloud.google.com/docs/authentication/external/set-up-adc for more information.'
[0m13:00:21.458693 [debug] [MainThread]: BigQuery adapter: Unhandled error while running:
select 1 as id
[0m13:00:21.459357 [debug] [MainThread]: BigQuery adapter: Database Error
  Runtime Error
    Failed to authenticate with supplied credentials
    error:
    Your default credentials were not found. To set up Application Default Credentials, see https://cloud.google.com/docs/authentication/external/set-up-adc for more information.
[0m13:00:21.460055 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m13:00:21.460561 [info ] [MainThread]: [31m1 check failed:[0m
[0m13:00:21.460971 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >'NoneType' object has no attribute 'close'

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m13:00:21.462017 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": false, "command_wall_clock_time": 12.988929, "process_in_blocks": "0", "process_kernel_time": 2.42525, "process_mem_max_rss": "219906048", "process_out_blocks": "0", "process_user_time": 1.622051}
[0m13:00:21.463114 [debug] [MainThread]: Command `dbt debug` failed at 13:00:21.462933 after 12.99 seconds
[0m13:00:21.463878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a87f310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9070d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a907e10>]}
[0m13:00:21.464468 [debug] [MainThread]: Flushing usage events
[0m13:00:22.678398 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:03:47.826565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a1eb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a93b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104aa3f50>]}


============================== 13:03:47.830292 | d8a81697-8969-413b-97e8-3f59f22e687a ==============================
[0m13:03:47.830292 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:03:47.830601 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:03:47.840115 [info ] [MainThread]: dbt version: 1.9.2
[0m13:03:47.840589 [info ] [MainThread]: python version: 3.11.4
[0m13:03:47.840890 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11
[0m13:03:47.841110 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit
[0m13:03:48.825712 [info ] [MainThread]: Using profiles dir at /Users/edou/.dbt
[0m13:03:48.826075 [info ] [MainThread]: Using profiles.yml file at /Users/edou/.dbt/profiles.yml
[0m13:03:48.826232 [info ] [MainThread]: Using dbt_project.yml file at /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/dbt_project.yml
[0m13:03:48.826375 [info ] [MainThread]: adapter type: bigquery
[0m13:03:48.826505 [info ] [MainThread]: adapter version: 1.9.1
[0m13:03:48.877228 [info ] [MainThread]: Configuration:
[0m13:03:48.877544 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:03:48.877694 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:03:48.877825 [info ] [MainThread]: Required dependencies:
[0m13:03:48.878021 [debug] [MainThread]: Executing "git --help"
[0m13:03:48.916266 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:03:48.916960 [debug] [MainThread]: STDERR: "b''"
[0m13:03:48.917160 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:03:48.917327 [info ] [MainThread]: Connection:
[0m13:03:48.917558 [info ] [MainThread]:   method: oauth
[0m13:03:48.917684 [info ] [MainThread]:   database: salesanalysis-450811
[0m13:03:48.917809 [info ] [MainThread]:   execution_project: salesanalysis-450811
[0m13:03:48.917926 [info ] [MainThread]:   schema: sales_analysis
[0m13:03:48.918045 [info ] [MainThread]:   location: EU
[0m13:03:48.918161 [info ] [MainThread]:   priority: interactive
[0m13:03:48.918276 [info ] [MainThread]:   maximum_bytes_billed: None
[0m13:03:48.918396 [info ] [MainThread]:   impersonate_service_account: None
[0m13:03:48.918510 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m13:03:48.918624 [info ] [MainThread]:   job_retries: 1
[0m13:03:48.918747 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m13:03:48.918864 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m13:03:48.918983 [info ] [MainThread]:   timeout_seconds: 300
[0m13:03:48.919100 [info ] [MainThread]:   client_id: None
[0m13:03:48.919217 [info ] [MainThread]:   token_uri: None
[0m13:03:48.919331 [info ] [MainThread]:   dataproc_region: None
[0m13:03:48.919444 [info ] [MainThread]:   dataproc_cluster_name: None
[0m13:03:48.919559 [info ] [MainThread]:   gcs_bucket: None
[0m13:03:48.919677 [info ] [MainThread]:   dataproc_batch: None
[0m13:03:48.919983 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:03:49.006244 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m13:03:49.006639 [debug] [MainThread]: On debug: select 1 as id
[0m13:03:49.006814 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:03:52.886264 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:6a148bfe-4a83-4a15-8043-b8e694d1ec2c&page=queryresults
[0m13:03:53.406040 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:03:53.406864 [info ] [MainThread]: [32mAll checks passed![0m
[0m13:03:53.407750 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 5.619246, "process_in_blocks": "0", "process_kernel_time": 2.466906, "process_mem_max_rss": "227131392", "process_out_blocks": "0", "process_user_time": 1.695705}
[0m13:03:53.408535 [debug] [MainThread]: Command `dbt debug` succeeded at 13:03:53.408394 after 5.62 seconds
[0m13:03:53.409027 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:03:53.409528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a24710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100bb7cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100bb7b90>]}
[0m13:03:53.410126 [debug] [MainThread]: Flushing usage events
[0m13:03:54.689670 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:16:17.325667 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064925d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065138d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106513e50>]}


============================== 13:16:17.329666 | 849e2012-4b99-40be-acc5-3210bf2bf357 ==============================
[0m13:16:17.329666 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:16:17.330114 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:16:18.536590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '849e2012-4b99-40be-acc5-3210bf2bf357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601d250>]}
[0m13:16:18.567618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '849e2012-4b99-40be-acc5-3210bf2bf357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104560790>]}
[0m13:16:18.567956 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:16:18.665457 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:16:18.665973 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m13:16:18.666189 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '849e2012-4b99-40be-acc5-3210bf2bf357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064ebb10>]}
[0m13:16:19.001997 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:16:19.004429 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '849e2012-4b99-40be-acc5-3210bf2bf357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b480e10>]}
[0m13:16:19.023589 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:16:19.027929 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:16:19.039706 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '849e2012-4b99-40be-acc5-3210bf2bf357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15410e7d0>]}
[0m13:16:19.039985 [info ] [MainThread]: Found 491 macros
[0m13:16:19.040172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '849e2012-4b99-40be-acc5-3210bf2bf357', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13fffe9d0>]}
[0m13:16:19.040760 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m13:16:19.041019 [debug] [MainThread]: Command end result
[0m13:16:19.051186 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:16:19.052010 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:16:19.053563 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:16:19.053842 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.7742935, "process_in_blocks": "0", "process_kernel_time": 2.055655, "process_mem_max_rss": "226934784", "process_out_blocks": "0", "process_user_time": 2.197725}
[0m13:16:19.054100 [debug] [MainThread]: Command `dbt run` succeeded at 13:16:19.054060 after 1.77 seconds
[0m13:16:19.054293 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b9bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024e8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10255ccd0>]}
[0m13:16:19.054475 [debug] [MainThread]: Flushing usage events
[0m13:16:20.291735 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:16:38.700796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049ae390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a2f8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a2fa50>]}


============================== 13:16:38.703765 | b23a4f1c-c9a9-41ea-b571-229f1d43cc56 ==============================
[0m13:16:38.703765 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:16:38.704088 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt test', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:16:39.285402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b23a4f1c-c9a9-41ea-b571-229f1d43cc56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13610a710>]}
[0m13:16:39.316069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b23a4f1c-c9a9-41ea-b571-229f1d43cc56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a7c810>]}
[0m13:16:39.316389 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:16:39.410993 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:16:39.447103 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:16:39.447334 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:16:39.447675 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:16:39.450274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b23a4f1c-c9a9-41ea-b571-229f1d43cc56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13644e410>]}
[0m13:16:39.470626 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:16:39.474659 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:16:39.492358 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b23a4f1c-c9a9-41ea-b571-229f1d43cc56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x137136150>]}
[0m13:16:39.492668 [info ] [MainThread]: Found 491 macros
[0m13:16:39.492843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b23a4f1c-c9a9-41ea-b571-229f1d43cc56', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13636a410>]}
[0m13:16:39.493504 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m13:16:39.494343 [debug] [MainThread]: Command end result
[0m13:16:39.504450 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:16:39.505371 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:16:39.507138 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:16:39.507468 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.8411529, "process_in_blocks": "0", "process_kernel_time": 2.377895, "process_mem_max_rss": "232767488", "process_out_blocks": "0", "process_user_time": 1.56439}
[0m13:16:39.507745 [debug] [MainThread]: Command `dbt test` succeeded at 13:16:39.507702 after 0.84 seconds
[0m13:16:39.507945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a2fe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a2fe10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1363e00d0>]}
[0m13:16:39.508122 [debug] [MainThread]: Flushing usage events
[0m13:16:40.271118 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:17:57.263879 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a6b490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aef9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aeff90>]}


============================== 13:17:57.267399 | 53e295ad-72b1-46b5-b0c7-397bd30e6b84 ==============================
[0m13:17:57.267399 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:17:57.267718 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:17:57.274720 [info ] [MainThread]: dbt version: 1.9.2
[0m13:17:57.275036 [info ] [MainThread]: python version: 3.11.4
[0m13:17:57.275207 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11
[0m13:17:57.275352 [info ] [MainThread]: os info: macOS-14.6.1-arm64-arm-64bit
[0m13:17:58.219975 [info ] [MainThread]: Using profiles dir at /Users/edou/.dbt
[0m13:17:58.220277 [info ] [MainThread]: Using profiles.yml file at /Users/edou/.dbt/profiles.yml
[0m13:17:58.220477 [info ] [MainThread]: Using dbt_project.yml file at /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/dbt_project.yml
[0m13:17:58.220634 [info ] [MainThread]: adapter type: bigquery
[0m13:17:58.220767 [info ] [MainThread]: adapter version: 1.9.1
[0m13:17:58.273822 [info ] [MainThread]: Configuration:
[0m13:17:58.274135 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m13:17:58.274276 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m13:17:58.274401 [info ] [MainThread]: Required dependencies:
[0m13:17:58.274577 [debug] [MainThread]: Executing "git --help"
[0m13:17:58.297549 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m13:17:58.298248 [debug] [MainThread]: STDERR: "b''"
[0m13:17:58.298457 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m13:17:58.298654 [info ] [MainThread]: Connection:
[0m13:17:58.298893 [info ] [MainThread]:   method: oauth
[0m13:17:58.299026 [info ] [MainThread]:   database: salesanalysis-450811
[0m13:17:58.299151 [info ] [MainThread]:   execution_project: salesanalysis-450811
[0m13:17:58.299275 [info ] [MainThread]:   schema: sales_analysis
[0m13:17:58.299396 [info ] [MainThread]:   location: EU
[0m13:17:58.299513 [info ] [MainThread]:   priority: interactive
[0m13:17:58.299636 [info ] [MainThread]:   maximum_bytes_billed: None
[0m13:17:58.299754 [info ] [MainThread]:   impersonate_service_account: None
[0m13:17:58.299880 [info ] [MainThread]:   job_retry_deadline_seconds: None
[0m13:17:58.300006 [info ] [MainThread]:   job_retries: 1
[0m13:17:58.300123 [info ] [MainThread]:   job_creation_timeout_seconds: None
[0m13:17:58.300240 [info ] [MainThread]:   job_execution_timeout_seconds: 300
[0m13:17:58.300354 [info ] [MainThread]:   timeout_seconds: 300
[0m13:17:58.300472 [info ] [MainThread]:   client_id: None
[0m13:17:58.300585 [info ] [MainThread]:   token_uri: None
[0m13:17:58.300707 [info ] [MainThread]:   dataproc_region: None
[0m13:17:58.300824 [info ] [MainThread]:   dataproc_cluster_name: None
[0m13:17:58.300935 [info ] [MainThread]:   gcs_bucket: None
[0m13:17:58.301050 [info ] [MainThread]:   dataproc_batch: None
[0m13:17:58.301392 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:17:58.386440 [debug] [MainThread]: Acquiring new bigquery connection 'debug'
[0m13:17:58.386835 [debug] [MainThread]: On debug: select 1 as id
[0m13:17:58.387021 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:18:00.216673 [debug] [MainThread]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2fa0eebb-71b8-49b1-8613-949699a3fa70&page=queryresults
[0m13:18:00.689427 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m13:18:00.690373 [info ] [MainThread]: [32mAll checks passed![0m
[0m13:18:00.691364 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 3.4639344, "process_in_blocks": "0", "process_kernel_time": 2.500824, "process_mem_max_rss": "226918400", "process_out_blocks": "0", "process_user_time": 1.600301}
[0m13:18:00.692164 [debug] [MainThread]: Command `dbt debug` succeeded at 13:18:00.692018 after 3.46 seconds
[0m13:18:00.692664 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m13:18:00.693164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x141ebfe10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b34cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067ab590>]}
[0m13:18:00.693740 [debug] [MainThread]: Flushing usage events
[0m13:18:01.840731 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:18:06.462477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112883790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112883450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112907fd0>]}


============================== 13:18:06.465608 | 8ba44eac-cd96-4a72-bc37-428cd039336b ==============================
[0m13:18:06.465608 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:18:06.465927 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:18:07.193250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106dfe50>]}
[0m13:18:07.224405 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110140d90>]}
[0m13:18:07.224768 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:18:07.315937 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:18:07.355994 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 3 files added, 0 files changed.
[0m13:18:07.356304 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_2023_count.yml
[0m13:18:07.356467 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_2023_count.sql
[0m13:18:07.356624 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/schema.yml
[0m13:18:07.684055 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:18:07.689051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cfd6bd0>]}
[0m13:18:07.729148 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:18:07.732900 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:18:07.745532 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cc26910>]}
[0m13:18:07.745822 [info ] [MainThread]: Found 1 model, 2 data tests, 2 sources, 491 macros
[0m13:18:07.745989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cdb0d50>]}
[0m13:18:07.746686 [info ] [MainThread]: 
[0m13:18:07.746850 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:18:07.746979 [info ] [MainThread]: 
[0m13:18:07.747199 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:18:07.747616 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:18:07.747787 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:18:09.021154 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m13:18:09.022253 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:18:09.642266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12762d250>]}
[0m13:18:09.643492 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:18:09.646494 [debug] [Thread-1 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:18:09.647211 [info ] [Thread-1 (]: 1 of 1 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:18:09.648028 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.orders_2023_count)
[0m13:18:09.648454 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:18:09.658986 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:18:09.660551 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:18:09.683276 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:18:09.684244 [debug] [Thread-1 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`sales_analysis`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:18:09.684609 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:18:10.080237 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:14f252da-41d9-4a70-9374-a4cd04d2d377&page=queryresults
[0m13:18:10.081927 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:14f252da-41d9-4a70-9374-a4cd04d2d377&page=queryresults
[0m13:18:10.096156 [debug] [Thread-1 (]: Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Dataset salesanalysis-450811:sales_analysis was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql
[0m13:18:10.099012 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8ba44eac-cd96-4a72-bc37-428cd039336b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128e8050>]}
[0m13:18:10.099809 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model sales_analysis.orders_2023_count .......... [[31mERROR[0m in 0.45s]
[0m13:18:10.100413 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:18:10.100983 [debug] [Thread-7 (]: Marking all children of 'model.salesAnalysis.orders_2023_count' to be skipped because of status 'error'.  Reason: Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Dataset salesanalysis-450811:sales_analysis was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql.
[0m13:18:10.102366 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:18:10.102948 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:18:10.103214 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:18:10.103476 [info ] [MainThread]: 
[0m13:18:10.103748 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.36 seconds (2.36s).
[0m13:18:10.104257 [debug] [MainThread]: Command end result
[0m13:18:10.123409 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:18:10.125166 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:18:10.128951 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:18:10.129186 [info ] [MainThread]: 
[0m13:18:10.129437 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:18:10.129625 [info ] [MainThread]: 
[0m13:18:10.129918 [error] [MainThread]:   Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Dataset salesanalysis-450811:sales_analysis was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql
[0m13:18:10.130151 [info ] [MainThread]: 
[0m13:18:10.130355 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:18:10.130709 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 3.7041094, "process_in_blocks": "0", "process_kernel_time": 2.486586, "process_mem_max_rss": "245661696", "process_out_blocks": "0", "process_user_time": 1.984408}
[0m13:18:10.131062 [debug] [MainThread]: Command `dbt run` failed at 13:18:10.131011 after 3.70 seconds
[0m13:18:10.131335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11287f650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a15a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d71790>]}
[0m13:18:10.131554 [debug] [MainThread]: Flushing usage events
[0m13:18:10.909055 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:22:33.067774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10828e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108313dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108313fd0>]}


============================== 13:22:33.071314 | 77075f4a-22e1-4d90-861e-640d36d8d013 ==============================
[0m13:22:33.071314 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:22:33.071626 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'debug': 'False', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:22:34.153419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ef80350>]}
[0m13:22:34.184017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10635c690>]}
[0m13:22:34.184338 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:22:34.277005 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:22:34.339948 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:22:34.340168 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:22:34.342606 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:22:34.361038 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f1ba4d0>]}
[0m13:22:34.401698 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:22:34.405399 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:22:34.416173 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f6ef750>]}
[0m13:22:34.416447 [info ] [MainThread]: Found 1 model, 2 data tests, 2 sources, 491 macros
[0m13:22:34.416621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f3eac10>]}
[0m13:22:34.417347 [info ] [MainThread]: 
[0m13:22:34.417517 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:22:34.417645 [info ] [MainThread]: 
[0m13:22:34.417897 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:22:34.418329 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:22:34.418511 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:22:35.790833 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now create_salesanalysis-450811_sales_analysis)
[0m13:22:35.793616 [debug] [ThreadPool]: Creating schema "database: "salesanalysis-450811"
schema: "sales_analysis"
"
[0m13:22:35.806956 [debug] [ThreadPool]: On create_salesanalysis-450811_sales_analysis: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "connection_name": "create_salesanalysis-450811_sales_analysis"} */
create schema if not exists `salesanalysis-450811`.`sales_analysis`
  
[0m13:22:35.807355 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:22:36.435731 [debug] [ThreadPool]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f460b255-dd5d-4497-a745-755144062df9&page=queryresults
[0m13:22:38.768085 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811_sales_analysis'
[0m13:22:38.768391 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:22:39.405048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1462ab490>]}
[0m13:22:39.406106 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:22:39.408866 [debug] [Thread-1 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:22:39.409525 [info ] [Thread-1 (]: 1 of 1 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:22:39.410060 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.orders_2023_count)
[0m13:22:39.410466 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:22:39.419756 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:22:39.420888 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:22:39.441517 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:22:39.442253 [debug] [Thread-1 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`sales_analysis`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:22:39.442558 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:22:40.220179 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:77eb5420-a359-4c5a-96da-e3316b0a1058&page=queryresults
[0m13:22:40.222637 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:77eb5420-a359-4c5a-96da-e3316b0a1058&page=queryresults
[0m13:22:40.237393 [debug] [Thread-1 (]: Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Table salesanalysis-450811:sales_analysis.orders_recrutement was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql
[0m13:22:40.239708 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '77075f4a-22e1-4d90-861e-640d36d8d013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x146376a10>]}
[0m13:22:40.240436 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model sales_analysis.orders_2023_count .......... [[31mERROR[0m in 0.83s]
[0m13:22:40.240922 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:22:40.241685 [debug] [Thread-7 (]: Marking all children of 'model.salesAnalysis.orders_2023_count' to be skipped because of status 'error'.  Reason: Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Table salesanalysis-450811:sales_analysis.orders_recrutement was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql.
[0m13:22:40.243079 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:22:40.243650 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:22:40.243896 [debug] [MainThread]: Connection 'create_salesanalysis-450811_sales_analysis' was properly closed.
[0m13:22:40.244114 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:22:40.244367 [info ] [MainThread]: 
[0m13:22:40.244615 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 5.83 seconds (5.83s).
[0m13:22:40.245131 [debug] [MainThread]: Command end result
[0m13:22:40.318764 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:22:40.319749 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:22:40.322443 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:22:40.322598 [info ] [MainThread]: 
[0m13:22:40.322796 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:22:40.322952 [info ] [MainThread]: 
[0m13:22:40.323128 [error] [MainThread]:   Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Table salesanalysis-450811:sales_analysis.orders_recrutement was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql
[0m13:22:40.323261 [info ] [MainThread]: 
[0m13:22:40.323401 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:22:40.323644 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 7.293706, "process_in_blocks": "0", "process_kernel_time": 2.462491, "process_mem_max_rss": "235110400", "process_out_blocks": "0", "process_user_time": 2.05365}
[0m13:22:40.323896 [debug] [MainThread]: Command `dbt run` failed at 13:22:40.323859 after 7.29 seconds
[0m13:22:40.324092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043a8b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043a8c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083028d0>]}
[0m13:22:40.324261 [debug] [MainThread]: Flushing usage events
[0m13:22:41.549471 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:23:31.490778 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104925510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104937d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104937f90>]}


============================== 13:23:31.494283 | c137ee51-71a6-4915-ae60-1ad3ae9692ab ==============================
[0m13:23:31.494283 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:23:31.494596 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:23:32.476771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1517ebf10>]}
[0m13:23:32.509419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102984790>]}
[0m13:23:32.509806 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:23:32.601250 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:23:32.661984 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m13:23:32.662370 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/schema.yml
[0m13:23:32.969692 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:23:32.974691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1518b8410>]}
[0m13:23:33.013173 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:23:33.016803 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:23:33.028867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15173d8d0>]}
[0m13:23:33.029177 [info ] [MainThread]: Found 1 model, 2 data tests, 2 sources, 491 macros
[0m13:23:33.029352 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151bdd690>]}
[0m13:23:33.030074 [info ] [MainThread]: 
[0m13:23:33.030234 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:23:33.030361 [info ] [MainThread]: 
[0m13:23:33.030598 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:23:33.031030 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:23:33.031199 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:23:34.307890 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m13:23:34.309020 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:23:34.703086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103b57250>]}
[0m13:23:34.704441 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:23:34.707035 [debug] [Thread-1 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:23:34.707726 [info ] [Thread-1 (]: 1 of 1 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:23:34.708260 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.orders_2023_count)
[0m13:23:34.708626 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:23:34.720570 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:23:34.722968 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:23:34.767593 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:23:34.768279 [debug] [Thread-1 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders_recrutement`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:23:34.768539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:23:35.415974 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:30f8495c-cf22-4d21-8fec-996a229e7f35&page=queryresults
[0m13:23:35.417126 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:30f8495c-cf22-4d21-8fec-996a229e7f35&page=queryresults
[0m13:23:35.430779 [debug] [Thread-1 (]: Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Table salesanalysis-450811:salesAnalysis.orders_recrutement was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql
[0m13:23:35.433000 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c137ee51-71a6-4915-ae60-1ad3ae9692ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x151764a10>]}
[0m13:23:35.433690 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model sales_analysis.orders_2023_count .......... [[31mERROR[0m in 0.72s]
[0m13:23:35.434175 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:23:35.434649 [debug] [Thread-7 (]: Marking all children of 'model.salesAnalysis.orders_2023_count' to be skipped because of status 'error'.  Reason: Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Table salesanalysis-450811:salesAnalysis.orders_recrutement was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql.
[0m13:23:35.435796 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:23:35.436545 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:23:35.436810 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:23:35.437054 [info ] [MainThread]: 
[0m13:23:35.437293 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.41 seconds (2.41s).
[0m13:23:35.437750 [debug] [MainThread]: Command end result
[0m13:23:35.455488 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:23:35.457012 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:23:35.460616 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:23:35.460818 [info ] [MainThread]: 
[0m13:23:35.461062 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:23:35.461244 [info ] [MainThread]: 
[0m13:23:35.461465 [error] [MainThread]:   Database Error in model orders_2023_count (models/orders_2023_count.sql)
  Not found: Table salesanalysis-450811:salesAnalysis.orders_recrutement was not found in location EU
  compiled code at target/run/salesAnalysis/models/orders_2023_count.sql
[0m13:23:35.461642 [info ] [MainThread]: 
[0m13:23:35.461829 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:23:35.462135 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.00739, "process_in_blocks": "0", "process_kernel_time": 2.517337, "process_mem_max_rss": "245071872", "process_out_blocks": "0", "process_user_time": 2.127758}
[0m13:23:35.462436 [debug] [MainThread]: Command `dbt run` failed at 13:23:35.462394 after 4.01 seconds
[0m13:23:35.462695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048af4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1046d5c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104954890>]}
[0m13:23:35.462904 [debug] [MainThread]: Flushing usage events
[0m13:23:36.226781 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:37:30.271651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085ec290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10866fe50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108691090>]}


============================== 13:37:30.275249 | 31e7940f-eac0-4a4c-ba6a-d7141375d427 ==============================
[0m13:37:30.275249 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:37:30.275559 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/edou/.dbt', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m13:37:31.384333 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085f6dd0>]}
[0m13:37:31.415148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066af510>]}
[0m13:37:31.415480 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:37:31.508717 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:37:31.572369 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m13:37:31.572784 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/schema.yml
[0m13:37:31.572963 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/orders_2023_count.sql
[0m13:37:31.881292 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:37:31.886259 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13635e190>]}
[0m13:37:31.926682 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:37:31.930823 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:37:31.943406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108645550>]}
[0m13:37:31.943707 [info ] [MainThread]: Found 1 model, 2 data tests, 2 sources, 491 macros
[0m13:37:31.943878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x133d09490>]}
[0m13:37:31.944611 [info ] [MainThread]: 
[0m13:37:31.944777 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:37:31.944908 [info ] [MainThread]: 
[0m13:37:31.945149 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:37:31.945599 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:37:31.945795 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:37:33.792809 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m13:37:33.793889 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:37:34.213613 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1363d2fd0>]}
[0m13:37:34.214940 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:37:34.217997 [debug] [Thread-1 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:37:34.218798 [info ] [Thread-1 (]: 1 of 1 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:37:34.219410 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.orders_2023_count)
[0m13:37:34.219823 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:37:34.230219 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:37:34.231704 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:37:34.255165 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:37:34.255901 [debug] [Thread-1 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:37:34.256227 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:35.002641 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:51f88897-08f5-4366-ade6-79c20ee4353e&page=queryresults
[0m13:37:35.451316 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '31e7940f-eac0-4a4c-ba6a-d7141375d427', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x136799790>]}
[0m13:37:35.451758 [info ] [Thread-1 (]: 1 of 1 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m13:37:35.452089 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:37:35.452776 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:37:35.453091 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:37:35.453247 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:37:35.453409 [info ] [MainThread]: 
[0m13:37:35.453573 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.51 seconds (3.51s).
[0m13:37:35.453902 [debug] [MainThread]: Command end result
[0m13:37:35.466358 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:37:35.467801 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:37:35.470866 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:37:35.471057 [info ] [MainThread]: 
[0m13:37:35.471278 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:37:35.471428 [info ] [MainThread]: 
[0m13:37:35.471599 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:37:35.471875 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.2412133, "process_in_blocks": "0", "process_kernel_time": 2.493157, "process_mem_max_rss": "247529472", "process_out_blocks": "0", "process_user_time": 2.21284}
[0m13:37:35.472162 [debug] [MainThread]: Command `dbt run` succeeded at 13:37:35.472117 after 5.24 seconds
[0m13:37:35.472390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10866f910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10866c2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104787b90>]}
[0m13:37:35.472585 [debug] [MainThread]: Flushing usage events
[0m13:37:36.722108 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:53:50.348869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041432d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041c0110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041c3e50>]}


============================== 13:53:50.352632 | e6373183-e24e-4ca7-ac93-9a78171ec1c3 ==============================
[0m13:53:50.352632 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:53:50.352961 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:53:51.455165 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1041540d0>]}
[0m13:53:51.486481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102214990>]}
[0m13:53:51.486889 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:53:51.580455 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:53:51.647739 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:53:51.647974 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:53:51.650494 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:53:51.668909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f077210>]}
[0m13:53:51.708143 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:53:51.712634 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:53:51.723920 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f70bd10>]}
[0m13:53:51.724212 [info ] [MainThread]: Found 1 model, 2 data tests, 2 sources, 491 macros
[0m13:53:51.724395 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13dd586d0>]}
[0m13:53:51.725174 [info ] [MainThread]: 
[0m13:53:51.725358 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:53:51.725503 [info ] [MainThread]: 
[0m13:53:51.725762 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:53:51.726208 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:53:51.726396 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:53:53.494174 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m13:53:53.498912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:53:53.911729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13f70a950>]}
[0m13:53:53.912881 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:53:53.915881 [debug] [Thread-1 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:53:53.916563 [info ] [Thread-1 (]: 1 of 1 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:53:53.917194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.orders_2023_count)
[0m13:53:53.917613 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:53:53.929797 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:53:53.932183 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:53:53.954241 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:53:53.955008 [debug] [Thread-1 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:53:53.955321 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:53:54.835857 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:aafd2b40-5b75-4e3d-9241-9c4a7f048a83&page=queryresults
[0m13:53:55.343347 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e6373183-e24e-4ca7-ac93-9a78171ec1c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x14d5012d0>]}
[0m13:53:55.343820 [info ] [Thread-1 (]: 1 of 1 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.43s]
[0m13:53:55.344147 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:53:55.344913 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:53:55.345265 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:53:55.345435 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:53:55.345610 [info ] [MainThread]: 
[0m13:53:55.345781 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 3.62 seconds (3.62s).
[0m13:53:55.346115 [debug] [MainThread]: Command end result
[0m13:53:55.416811 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:53:55.417748 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:53:55.420444 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:53:55.420606 [info ] [MainThread]: 
[0m13:53:55.420813 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:53:55.420955 [info ] [MainThread]: 
[0m13:53:55.421103 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:53:55.421352 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.114097, "process_in_blocks": "0", "process_kernel_time": 2.561215, "process_mem_max_rss": "233979904", "process_out_blocks": "0", "process_user_time": 1.916905}
[0m13:53:55.421628 [debug] [MainThread]: Command `dbt run` succeeded at 13:53:55.421592 after 5.11 seconds
[0m13:53:55.421836 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10020ccd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103e83590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002dbb90>]}
[0m13:53:55.422009 [debug] [MainThread]: Flushing usage events
[0m13:53:56.574112 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:55:27.547849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10854fb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085cff90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085cffd0>]}


============================== 13:55:27.551500 | a897320a-6319-4fdc-a5e7-8099c08b3109 ==============================
[0m13:55:27.551500 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:55:27.551810 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:55:28.656325 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d10a710>]}
[0m13:55:28.687817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106613fd0>]}
[0m13:55:28.688238 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:55:28.779074 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:55:28.844030 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m13:55:28.844358 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_per_month_2023.sql
[0m13:55:28.844547 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_per_month_2023.yml
[0m13:55:29.114247 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:55:29.119963 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d5ba810>]}
[0m13:55:29.161030 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:55:29.164910 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:55:29.178007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075e0ed0>]}
[0m13:55:29.178323 [info ] [MainThread]: Found 2 models, 6 data tests, 2 sources, 491 macros
[0m13:55:29.178496 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f3d5490>]}
[0m13:55:29.179307 [info ] [MainThread]: 
[0m13:55:29.179472 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:55:29.179606 [info ] [MainThread]: 
[0m13:55:29.179836 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:55:29.181727 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:55:29.181931 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:55:30.507773 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m13:55:30.509439 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:55:30.919019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12d471250>]}
[0m13:55:30.920142 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:55:30.922637 [debug] [Thread-1 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:55:30.923088 [debug] [Thread-2 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m13:55:30.923781 [info ] [Thread-1 (]: 1 of 2 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:55:30.924509 [info ] [Thread-2 (]: 2 of 2 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m13:55:30.925256 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.orders_2023_count)
[0m13:55:30.925994 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m13:55:30.926479 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:55:30.926876 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m13:55:30.936319 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:55:30.939141 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m13:55:30.941429 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m13:55:30.960343 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:55:30.963071 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m13:55:30.965079 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:55:30.965886 [debug] [Thread-2 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m13:55:30.966223 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:55:30.967157 [debug] [Thread-1 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:55:30.967482 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:55:31.647296 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:b55f0c1f-1811-4a13-b4c1-665757eb6569&page=queryresults
[0m13:55:31.670264 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:e7aa2091-caa7-488a-bc92-6d5f984d70b7&page=queryresults
[0m13:55:32.095515 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12f366bd0>]}
[0m13:55:32.095735 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a897320a-6319-4fdc-a5e7-8099c08b3109', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a57ed0>]}
[0m13:55:32.096174 [info ] [Thread-2 (]: 2 of 2 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.17s]
[0m13:55:32.096559 [info ] [Thread-1 (]: 1 of 2 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.17s]
[0m13:55:32.096906 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m13:55:32.097176 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:55:32.097923 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:55:32.098251 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:55:32.098402 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:55:32.098536 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_per_month_2023' was properly closed.
[0m13:55:32.098718 [info ] [MainThread]: 
[0m13:55:32.098878 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 2.92 seconds (2.92s).
[0m13:55:32.099262 [debug] [MainThread]: Command end result
[0m13:55:32.112247 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:55:32.113318 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:55:32.116281 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:55:32.116512 [info ] [MainThread]: 
[0m13:55:32.116706 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:55:32.116843 [info ] [MainThread]: 
[0m13:55:32.116997 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m13:55:32.117259 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.6088705, "process_in_blocks": "0", "process_kernel_time": 2.480703, "process_mem_max_rss": "246611968", "process_out_blocks": "0", "process_user_time": 2.238661}
[0m13:55:32.117516 [debug] [MainThread]: Command `dbt run` succeeded at 13:55:32.117479 after 4.61 seconds
[0m13:55:32.117717 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085cf910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108262390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045a4d90>]}
[0m13:55:32.117889 [debug] [MainThread]: Flushing usage events
[0m13:55:33.455937 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m13:57:53.048175 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083ff090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10847f450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10847fe50>]}


============================== 13:57:53.052330 | b02f0e11-764f-4170-82f1-77f6df9719cc ==============================
[0m13:57:53.052330 [info ] [MainThread]: Running with dbt=1.9.2
[0m13:57:53.052660 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'profiles_dir': '/Users/edou/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:57:54.152031 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084a0f10>]}
[0m13:57:54.183813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064bf490>]}
[0m13:57:54.184215 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m13:57:54.274617 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m13:57:54.339445 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m13:57:54.339783 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/avg_products_per_order_2023.yml
[0m13:57:54.339950 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/avg_products_per_order_2023.sql
[0m13:57:54.618113 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m13:57:54.623819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13b78f090>]}
[0m13:57:54.665093 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:57:54.669094 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:57:54.682001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13a516650>]}
[0m13:57:54.682303 [info ] [MainThread]: Found 3 models, 10 data tests, 2 sources, 491 macros
[0m13:57:54.682475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13aeaf990>]}
[0m13:57:54.683372 [info ] [MainThread]: 
[0m13:57:54.683575 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:57:54.683712 [info ] [MainThread]: 
[0m13:57:54.683953 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m13:57:54.685820 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m13:57:54.686012 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:57:56.018104 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m13:57:56.019090 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:57:56.453155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13af17550>]}
[0m13:57:56.454139 [debug] [MainThread]: Opening a new connection, currently in state init
[0m13:57:56.457063 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m13:57:56.457550 [debug] [Thread-2 (]: Began running node model.salesAnalysis.orders_2023_count
[0m13:57:56.458563 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m13:57:56.458197 [info ] [Thread-1 (]: 1 of 3 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m13:57:56.459157 [info ] [Thread-2 (]: 2 of 3 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m13:57:56.459656 [info ] [Thread-3 (]: 3 of 3 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m13:57:56.460191 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m13:57:56.460958 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m13:57:56.461447 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m13:57:56.461856 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m13:57:56.462184 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m13:57:56.462485 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m13:57:56.472056 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m13:57:56.474782 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m13:57:56.477473 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m13:57:56.478561 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m13:57:56.491716 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m13:57:56.503636 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m13:57:56.504666 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m13:57:56.503296 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m13:57:56.506488 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m13:57:56.507076 [debug] [Thread-3 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m13:57:56.507393 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.orders_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m13:57:56.507663 [debug] [Thread-2 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m13:57:56.507906 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:57:56.508117 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:57:56.508339 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:57:57.165461 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:220efe55-7d52-44fe-ab12-c3c3cfd9b27b&page=queryresults
[0m13:57:57.167107 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:7946cd3f-38d7-4650-bbe3-ba57a36dae26&page=queryresults
[0m13:57:57.169987 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:ce9a4b17-c053-4175-885a-380481caf362&page=queryresults
[0m13:57:57.336414 [error] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:ce9a4b17-c053-4175-885a-380481caf362&page=queryresults
[0m13:57:57.351992 [debug] [Thread-1 (]: Database Error in model avg_products_per_order_2023 (models/avg_products_per_order_2023.sql)
  Name orders_id not found inside s at [14:28]
  compiled code at target/run/salesAnalysis/models/avg_products_per_order_2023.sql
[0m13:57:57.355497 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108448f10>]}
[0m13:57:57.357427 [error] [Thread-1 (]: 1 of 3 ERROR creating sql view model sales_analysis.avg_products_per_order_2023  [[31mERROR[0m in 0.89s]
[0m13:57:57.358810 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m13:57:57.359467 [debug] [Thread-7 (]: Marking all children of 'model.salesAnalysis.avg_products_per_order_2023' to be skipped because of status 'error'.  Reason: Database Error in model avg_products_per_order_2023 (models/avg_products_per_order_2023.sql)
  Name orders_id not found inside s at [14:28]
  compiled code at target/run/salesAnalysis/models/avg_products_per_order_2023.sql.
[0m13:57:57.596205 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f7010>]}
[0m13:57:57.597330 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b02f0e11-764f-4170-82f1-77f6df9719cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x13ada1690>]}
[0m13:57:57.597779 [info ] [Thread-2 (]: 2 of 3 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m13:57:57.598170 [info ] [Thread-3 (]: 3 of 3 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.14s]
[0m13:57:57.598516 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m13:57:57.598785 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m13:57:57.599584 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m13:57:57.599931 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:57:57.600114 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m13:57:57.600258 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m13:57:57.600392 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_per_month_2023' was properly closed.
[0m13:57:57.600589 [info ] [MainThread]: 
[0m13:57:57.600764 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 2.92 seconds (2.92s).
[0m13:57:57.601206 [debug] [MainThread]: Command end result
[0m13:57:57.614628 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m13:57:57.615778 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m13:57:57.619400 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m13:57:57.619645 [info ] [MainThread]: 
[0m13:57:57.619848 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m13:57:57.620000 [info ] [MainThread]: 
[0m13:57:57.620188 [error] [MainThread]:   Database Error in model avg_products_per_order_2023 (models/avg_products_per_order_2023.sql)
  Name orders_id not found inside s at [14:28]
  compiled code at target/run/salesAnalysis/models/avg_products_per_order_2023.sql
[0m13:57:57.620366 [info ] [MainThread]: 
[0m13:57:57.620554 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m13:57:57.620838 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 4.6123834, "process_in_blocks": "0", "process_kernel_time": 2.547434, "process_mem_max_rss": "246743040", "process_out_blocks": "0", "process_user_time": 2.130766}
[0m13:57:57.621111 [debug] [MainThread]: Command `dbt run` failed at 13:57:57.621073 after 4.61 seconds
[0m13:57:57.621330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083fb3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104519790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084077d0>]}
[0m13:57:57.621508 [debug] [MainThread]: Flushing usage events
[0m13:57:58.927515 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:01:13.190335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104452410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044d3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044f4e50>]}


============================== 14:01:13.193936 | 4d9d7455-e2d7-4870-9f48-6834f76bb4ec ==============================
[0m14:01:13.193936 [info ] [MainThread]: Running with dbt=1.9.2
[0m14:01:13.194288 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:01:14.291848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155917910>]}
[0m14:01:14.323764 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102513f10>]}
[0m14:01:14.324132 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:01:14.413662 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m14:01:14.477900 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:01:14.478281 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/avg_products_per_order_2023.sql
[0m14:01:14.748722 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m14:01:14.754437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155dce010>]}
[0m14:01:14.794486 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:01:14.798380 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:01:14.811809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1558ba890>]}
[0m14:01:14.812130 [info ] [MainThread]: Found 3 models, 10 data tests, 2 sources, 491 macros
[0m14:01:14.812299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1558a0d10>]}
[0m14:01:14.813144 [info ] [MainThread]: 
[0m14:01:14.813309 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:01:14.813438 [info ] [MainThread]: 
[0m14:01:14.813666 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:01:14.815563 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m14:01:14.815770 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:01:16.397695 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m14:01:16.398753 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:01:16.777997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1560d9590>]}
[0m14:01:16.778989 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:01:16.781374 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m14:01:16.781801 [debug] [Thread-2 (]: Began running node model.salesAnalysis.orders_2023_count
[0m14:01:16.782182 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m14:01:16.782714 [info ] [Thread-1 (]: 1 of 3 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m14:01:16.783207 [info ] [Thread-2 (]: 2 of 3 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m14:01:16.783791 [info ] [Thread-3 (]: 3 of 3 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m14:01:16.784376 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m14:01:16.785089 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m14:01:16.785553 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m14:01:16.785914 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m14:01:16.786234 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m14:01:16.786514 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m14:01:16.796054 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:01:16.798621 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m14:01:16.801398 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m14:01:16.802963 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m14:01:16.803244 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m14:01:16.815912 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m14:01:16.822243 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m14:01:16.823923 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:01:16.825495 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m14:01:16.826565 [debug] [Thread-3 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m14:01:16.826899 [debug] [Thread-2 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m14:01:16.827130 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:01:16.827357 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m14:01:16.827572 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:01:16.828443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:01:17.495303 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:9c6f9dad-99c4-4c8f-82cd-a183de76043f&page=queryresults
[0m14:01:17.497684 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2e3346e1-465a-4f4b-b435-afe7ee215bbe&page=queryresults
[0m14:01:17.939674 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:0267ceca-96db-405a-94b6-7fbc5c44eb20&page=queryresults
[0m14:01:18.058852 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x155e26410>]}
[0m14:01:18.059268 [info ] [Thread-1 (]: 1 of 3 OK created sql view model sales_analysis.avg_products_per_order_2023 .... [[32mCREATE VIEW (0 processed)[0m in 1.27s]
[0m14:01:18.059563 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m14:01:18.183578 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044aaa90>]}
[0m14:01:18.184163 [info ] [Thread-2 (]: 2 of 3 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.40s]
[0m14:01:18.184588 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m14:01:18.477734 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4d9d7455-e2d7-4870-9f48-6834f76bb4ec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1558f2ad0>]}
[0m14:01:18.478864 [info ] [Thread-3 (]: 3 of 3 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.69s]
[0m14:01:18.479562 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m14:01:18.481230 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:01:18.481939 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:01:18.482260 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m14:01:18.482560 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m14:01:18.482845 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_per_month_2023' was properly closed.
[0m14:01:18.483279 [info ] [MainThread]: 
[0m14:01:18.483634 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 3.67 seconds (3.67s).
[0m14:01:18.484951 [debug] [MainThread]: Command end result
[0m14:01:18.508715 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:01:18.510386 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:01:18.514441 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m14:01:18.514671 [info ] [MainThread]: 
[0m14:01:18.514908 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:01:18.515080 [info ] [MainThread]: 
[0m14:01:18.515276 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m14:01:18.515625 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.3630147, "process_in_blocks": "0", "process_kernel_time": 2.537157, "process_mem_max_rss": "248496128", "process_out_blocks": "0", "process_user_time": 2.192895}
[0m14:01:18.515948 [debug] [MainThread]: Command `dbt run` succeeded at 14:01:18.515897 after 5.36 seconds
[0m14:01:18.516232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1004a8d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10056cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10056dad0>]}
[0m14:01:18.516449 [debug] [MainThread]: Flushing usage events
[0m14:01:19.989542 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:04:15.247946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106081650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106083610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106107f90>]}


============================== 14:04:15.251634 | d3aa7217-07b8-4579-aea5-bcecb38b8602 ==============================
[0m14:04:15.251634 [info ] [MainThread]: Running with dbt=1.9.2
[0m14:04:15.251940 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'debug': 'False', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:04:16.357103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1609fe210>]}
[0m14:04:16.387674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10323cdd0>]}
[0m14:04:16.388004 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:04:16.478590 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m14:04:16.543586 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m14:04:16.543917 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_with_products_2022_2023.sql
[0m14:04:16.544104 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_with_products_2022_2023.yml
[0m14:04:16.810967 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m14:04:16.816930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160beb150>]}
[0m14:04:16.857148 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:04:16.860884 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:04:16.874415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1609a0a10>]}
[0m14:04:16.874721 [info ] [MainThread]: Found 4 models, 15 data tests, 2 sources, 491 macros
[0m14:04:16.874895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x160d531d0>]}
[0m14:04:16.875823 [info ] [MainThread]: 
[0m14:04:16.875996 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:04:16.876132 [info ] [MainThread]: 
[0m14:04:16.876372 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:04:16.878313 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m14:04:16.878515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:04:18.445982 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m14:04:18.446957 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:04:18.838191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16131ac10>]}
[0m14:04:18.839064 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:04:18.841571 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m14:04:18.841991 [debug] [Thread-2 (]: Began running node model.salesAnalysis.orders_2023_count
[0m14:04:18.842854 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m14:04:18.842534 [info ] [Thread-1 (]: 1 of 4 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m14:04:18.843479 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:04:18.844035 [info ] [Thread-2 (]: 2 of 4 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m14:04:18.844535 [info ] [Thread-3 (]: 3 of 4 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m14:04:18.845254 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m14:04:18.845660 [info ] [Thread-4 (]: 4 of 4 START sql view model sales_analysis.orders_with_products_2022_2023 ...... [RUN]
[0m14:04:18.846096 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m14:04:18.846460 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m14:04:18.846770 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m14:04:18.847126 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_with_products_2022_2023'
[0m14:04:18.847392 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m14:04:18.847648 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m14:04:18.855638 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:04:18.856038 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_with_products_2022_2023
[0m14:04:18.858277 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m14:04:18.860698 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m14:04:18.863543 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:04:18.864154 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m14:04:18.877087 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m14:04:18.877423 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m14:04:18.883651 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:04:18.885693 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m14:04:18.888662 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m14:04:18.888893 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_with_products_2022_2023
[0m14:04:18.890555 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:04:18.890885 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m14:04:18.891155 [debug] [Thread-2 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m14:04:18.891436 [debug] [Thread-3 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m14:04:18.891644 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:04:18.891834 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:04:18.892049 [debug] [Thread-4 (]: On model.salesAnalysis.orders_with_products_2022_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_products_2022_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_products_2022_2023`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m14:04:18.892250 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:04:18.893638 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:04:19.578344 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:716df4ba-9b58-45ff-8f87-0c1f17ef77cf&page=queryresults
[0m14:04:19.592184 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:52d99d4d-e27a-4b0a-86d5-68a1b1fe7179&page=queryresults
[0m14:04:19.601011 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:52eecff3-6294-47a9-a52b-68ed8fbf3196&page=queryresults
[0m14:04:19.603493 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:a4651697-75f5-48aa-bb77-75d2a4161974&page=queryresults
[0m14:04:20.033844 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1609a3b90>]}
[0m14:04:20.034049 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1608e6710>]}
[0m14:04:20.034229 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1608e43d0>]}
[0m14:04:20.034428 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd3aa7217-07b8-4579-aea5-bcecb38b8602', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x161083510>]}
[0m14:04:20.034817 [info ] [Thread-4 (]: 4 of 4 OK created sql view model sales_analysis.orders_with_products_2022_2023 . [[32mCREATE VIEW (0 processed)[0m in 1.18s]
[0m14:04:20.035134 [info ] [Thread-2 (]: 2 of 4 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.19s]
[0m14:04:20.035451 [info ] [Thread-3 (]: 3 of 4 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.19s]
[0m14:04:20.035754 [info ] [Thread-1 (]: 1 of 4 OK created sql view model sales_analysis.avg_products_per_order_2023 .... [[32mCREATE VIEW (0 processed)[0m in 1.19s]
[0m14:04:20.036058 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:04:20.036304 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m14:04:20.036541 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m14:04:20.036802 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m14:04:20.037567 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:04:20.037870 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:04:20.038010 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m14:04:20.038142 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m14:04:20.038268 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_per_month_2023' was properly closed.
[0m14:04:20.038392 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_with_products_2022_2023' was properly closed.
[0m14:04:20.038566 [info ] [MainThread]: 
[0m14:04:20.038719 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.16 seconds (3.16s).
[0m14:04:20.039198 [debug] [MainThread]: Command end result
[0m14:04:20.054181 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:04:20.055388 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:04:20.058421 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m14:04:20.058601 [info ] [MainThread]: 
[0m14:04:20.058808 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:04:20.058949 [info ] [MainThread]: 
[0m14:04:20.059106 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:04:20.059402 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.8507924, "process_in_blocks": "0", "process_kernel_time": 2.567449, "process_mem_max_rss": "248004608", "process_out_blocks": "0", "process_user_time": 2.164566}
[0m14:04:20.059660 [debug] [MainThread]: Command `dbt run` succeeded at 14:04:20.059624 after 4.85 seconds
[0m14:04:20.059858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061242d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106126550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103870f90>]}
[0m14:04:20.060024 [debug] [MainThread]: Flushing usage events
[0m14:04:21.266553 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:11:48.303463 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a66a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108adb790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ae7e50>]}


============================== 14:11:48.307567 | 8357822b-ac93-486c-8045-2d878752b8d3 ==============================
[0m14:11:48.307567 [info ] [MainThread]: Running with dbt=1.9.2
[0m14:11:48.307909 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'profiles_dir': '/Users/edou/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:11:49.405454 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab80c50>]}
[0m14:11:49.436142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b2bfd0>]}
[0m14:11:49.436461 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:11:49.529231 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m14:11:49.596128 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m14:11:49.596499 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/order_segments_2023.sql
[0m14:11:49.596690 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/order_segments_2023.yml
[0m14:11:49.871354 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m14:11:49.877213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fad6810>]}
[0m14:11:49.918935 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:11:49.922538 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:11:49.936180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12aae2650>]}
[0m14:11:49.936479 [info ] [MainThread]: Found 5 models, 20 data tests, 2 sources, 491 macros
[0m14:11:49.936648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10887b590>]}
[0m14:11:49.937593 [info ] [MainThread]: 
[0m14:11:49.937760 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:11:49.937892 [info ] [MainThread]: 
[0m14:11:49.938119 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:11:49.940007 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m14:11:49.940192 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:11:51.575757 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m14:11:51.576670 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:11:52.019874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108956710>]}
[0m14:11:52.021052 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:11:52.024253 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m14:11:52.024838 [debug] [Thread-2 (]: Began running node model.salesAnalysis.order_segments_2023
[0m14:11:52.025280 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_2023_count
[0m14:11:52.025890 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m14:11:52.026508 [info ] [Thread-1 (]: 1 of 5 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m14:11:52.027094 [info ] [Thread-2 (]: 2 of 5 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m14:11:52.027586 [info ] [Thread-3 (]: 3 of 5 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m14:11:52.028078 [info ] [Thread-4 (]: 4 of 5 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m14:11:52.028611 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m14:11:52.029121 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m14:11:52.029586 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m14:11:52.030041 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m14:11:52.030438 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m14:11:52.030797 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m14:11:52.031105 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m14:11:52.031394 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m14:11:52.041400 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:11:52.044471 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m14:11:52.046876 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m14:11:52.049238 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m14:11:52.050001 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m14:11:52.070214 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:11:52.070757 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m14:11:52.070952 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m14:11:52.071226 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m14:11:52.074651 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m14:11:52.076386 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m14:11:52.076684 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m14:11:52.078232 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m14:11:52.078718 [debug] [Thread-4 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m14:11:52.078938 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:11:52.079147 [debug] [Thread-3 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m14:11:52.079387 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:11:52.079630 [debug] [Thread-2 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.client_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.client_id = prev_orders.client_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.client_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m14:11:52.080466 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:11:52.081489 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:11:52.800877 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f8dd186b-a4d2-4167-b334-fc56cc2d9b7b&page=queryresults
[0m14:11:52.806701 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:b5c81cb3-4557-464e-bb1e-8aa5d3227580&page=queryresults
[0m14:11:52.807355 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:6ac276ee-57da-46d1-b153-5a7e2b15c025&page=queryresults
[0m14:11:52.810863 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:0c783c07-b1c5-4c33-92a9-c95677268b64&page=queryresults
[0m14:11:53.002103 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:b5c81cb3-4557-464e-bb1e-8aa5d3227580&page=queryresults
[0m14:11:53.018954 [debug] [Thread-2 (]: Database Error in model order_segments_2023 (models/order_segments_2023.sql)
  Name client_id not found inside o2023 at [15:18]
  compiled code at target/run/salesAnalysis/models/order_segments_2023.sql
[0m14:11:53.020998 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12abae550>]}
[0m14:11:53.021554 [error] [Thread-2 (]: 2 of 5 ERROR creating sql view model sales_analysis.order_segments_2023 ........ [[31mERROR[0m in 0.99s]
[0m14:11:53.021899 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m14:11:53.022135 [debug] [Thread-2 (]: Began running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:11:53.022407 [debug] [Thread-7 (]: Marking all children of 'model.salesAnalysis.order_segments_2023' to be skipped because of status 'error'.  Reason: Database Error in model order_segments_2023 (models/order_segments_2023.sql)
  Name client_id not found inside o2023 at [15:18]
  compiled code at target/run/salesAnalysis/models/order_segments_2023.sql.
[0m14:11:53.022677 [info ] [Thread-2 (]: 5 of 5 START sql view model sales_analysis.orders_with_products_2022_2023 ...... [RUN]
[0m14:11:53.023079 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.order_segments_2023, now model.salesAnalysis.orders_with_products_2022_2023)
[0m14:11:53.023290 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.orders_with_products_2022_2023
[0m14:11:53.025524 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:11:53.026185 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.orders_with_products_2022_2023
[0m14:11:53.028456 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:11:53.029125 [debug] [Thread-2 (]: On model.salesAnalysis.orders_with_products_2022_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_products_2022_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_products_2022_2023`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m14:11:53.029450 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:11:53.245261 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12fb29bd0>]}
[0m14:11:53.246279 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab54490>]}
[0m14:11:53.247150 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab64550>]}
[0m14:11:53.247751 [info ] [Thread-4 (]: 4 of 5 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m14:11:53.248100 [info ] [Thread-3 (]: 3 of 5 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m14:11:53.248405 [info ] [Thread-1 (]: 1 of 5 OK created sql view model sales_analysis.avg_products_per_order_2023 .... [[32mCREATE VIEW (0 processed)[0m in 1.22s]
[0m14:11:53.248700 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m14:11:53.248963 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m14:11:53.249226 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m14:11:53.925253 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:9768d206-11d2-4201-98e6-3b5d6b6647bf&page=queryresults
[0m14:11:54.329385 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8357822b-ac93-486c-8045-2d878752b8d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x138a75210>]}
[0m14:11:54.330422 [info ] [Thread-2 (]: 5 of 5 OK created sql view model sales_analysis.orders_with_products_2022_2023 . [[32mCREATE VIEW (0 processed)[0m in 1.31s]
[0m14:11:54.331087 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:11:54.332738 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:11:54.333492 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:11:54.333840 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m14:11:54.334123 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_with_products_2022_2023' was properly closed.
[0m14:11:54.334369 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m14:11:54.334625 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_per_month_2023' was properly closed.
[0m14:11:54.335030 [info ] [MainThread]: 
[0m14:11:54.335351 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 4.40 seconds (4.40s).
[0m14:11:54.336434 [debug] [MainThread]: Command end result
[0m14:11:54.360558 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:11:54.362025 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:11:54.365987 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m14:11:54.366210 [info ] [MainThread]: 
[0m14:11:54.366438 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:11:54.366617 [info ] [MainThread]: 
[0m14:11:54.366833 [error] [MainThread]:   Database Error in model order_segments_2023 (models/order_segments_2023.sql)
  Name client_id not found inside o2023 at [15:18]
  compiled code at target/run/salesAnalysis/models/order_segments_2023.sql
[0m14:11:54.367004 [info ] [MainThread]: 
[0m14:11:54.367180 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m14:11:54.367507 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 6.1029415, "process_in_blocks": "0", "process_kernel_time": 2.437198, "process_mem_max_rss": "248872960", "process_out_blocks": "0", "process_user_time": 2.381587}
[0m14:11:54.367830 [debug] [MainThread]: Command `dbt run` failed at 14:11:54.367782 after 6.10 seconds
[0m14:11:54.368103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a63350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b80b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b81750>]}
[0m14:11:54.368321 [debug] [MainThread]: Flushing usage events
[0m14:11:55.754662 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:13:05.065799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112283690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114f7ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112407fd0>]}


============================== 14:13:05.069452 | 2f14f262-6041-4499-9051-d11c8680d44a ==============================
[0m14:13:05.069452 [info ] [MainThread]: Running with dbt=1.9.2
[0m14:13:05.069759 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'profiles_dir': '/Users/edou/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:13:06.168676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cafc810>]}
[0m14:13:06.200894 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075441d0>]}
[0m14:13:06.201272 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:13:06.294459 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m14:13:06.359400 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:13:06.359782 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/order_segments_2023.sql
[0m14:13:06.630694 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m14:13:06.636981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cbb1610>]}
[0m14:13:06.678085 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:13:06.681697 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:13:06.694719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122987d0>]}
[0m14:13:06.695027 [info ] [MainThread]: Found 5 models, 20 data tests, 2 sources, 491 macros
[0m14:13:06.695194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca723d0>]}
[0m14:13:06.696144 [info ] [MainThread]: 
[0m14:13:06.696314 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:13:06.696446 [info ] [MainThread]: 
[0m14:13:06.696680 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:13:06.698573 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m14:13:06.698765 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:13:08.042012 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m14:13:08.044478 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:13:08.479539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114af9d0>]}
[0m14:13:08.480704 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:13:08.483722 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m14:13:08.484203 [debug] [Thread-2 (]: Began running node model.salesAnalysis.order_segments_2023
[0m14:13:08.484645 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_2023_count
[0m14:13:08.485802 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m14:13:08.485247 [info ] [Thread-1 (]: 1 of 5 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m14:13:08.486443 [info ] [Thread-2 (]: 2 of 5 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m14:13:08.487128 [info ] [Thread-3 (]: 3 of 5 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m14:13:08.487796 [info ] [Thread-4 (]: 4 of 5 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m14:13:08.488380 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m14:13:08.488852 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m14:13:08.489256 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m14:13:08.489651 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m14:13:08.489980 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m14:13:08.490287 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m14:13:08.490576 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m14:13:08.490871 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m14:13:08.500367 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:13:08.503232 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m14:13:08.505741 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m14:13:08.509845 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m14:13:08.511649 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m14:13:08.511932 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m14:13:08.512209 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m14:13:08.524491 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m14:13:08.531653 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m14:13:08.533453 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m14:13:08.535111 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:13:08.536608 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m14:13:08.537226 [debug] [Thread-4 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m14:13:08.537550 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:13:08.538269 [debug] [Thread-2 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.customer_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.customer_id = prev_orders.customer_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.customer_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m14:13:08.538562 [debug] [Thread-3 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m14:13:08.538819 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m14:13:08.539270 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:13:08.539555 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:13:08.539969 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:13:09.297408 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:88d296ab-2ea9-437d-a1ac-b81e868abf0d&page=queryresults
[0m14:13:09.301420 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:62f094a9-85b2-4daf-8cc2-3873ce705c97&page=queryresults
[0m14:13:09.302660 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:073b40c5-027a-4c72-b13f-e8c146fa3413&page=queryresults
[0m14:13:09.304580 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:9c45f398-ddf8-4d6a-8e37-1310f7c34d0c&page=queryresults
[0m14:13:09.517057 [error] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:073b40c5-027a-4c72-b13f-e8c146fa3413&page=queryresults
[0m14:13:09.535439 [debug] [Thread-2 (]: Database Error in model order_segments_2023 (models/order_segments_2023.sql)
  Name customer_id not found inside o2023 at [15:18]
  compiled code at target/run/salesAnalysis/models/order_segments_2023.sql
[0m14:13:09.538154 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca402d0>]}
[0m14:13:09.538860 [error] [Thread-2 (]: 2 of 5 ERROR creating sql view model sales_analysis.order_segments_2023 ........ [[31mERROR[0m in 1.05s]
[0m14:13:09.539451 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m14:13:09.539973 [debug] [Thread-2 (]: Began running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:13:09.540473 [debug] [Thread-7 (]: Marking all children of 'model.salesAnalysis.order_segments_2023' to be skipped because of status 'error'.  Reason: Database Error in model order_segments_2023 (models/order_segments_2023.sql)
  Name customer_id not found inside o2023 at [15:18]
  compiled code at target/run/salesAnalysis/models/order_segments_2023.sql.
[0m14:13:09.541002 [info ] [Thread-2 (]: 5 of 5 START sql view model sales_analysis.orders_with_products_2022_2023 ...... [RUN]
[0m14:13:09.541738 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.order_segments_2023, now model.salesAnalysis.orders_with_products_2022_2023)
[0m14:13:09.542088 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.orders_with_products_2022_2023
[0m14:13:09.545329 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:13:09.546343 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.orders_with_products_2022_2023
[0m14:13:09.548708 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:13:09.549254 [debug] [Thread-2 (]: On model.salesAnalysis.orders_with_products_2022_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_products_2022_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_products_2022_2023`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m14:13:09.549573 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:13:09.734587 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166ccd850>]}
[0m14:13:09.735580 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122bfc90>]}
[0m14:13:09.736479 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1681a19d0>]}
[0m14:13:09.736866 [info ] [Thread-3 (]: 3 of 5 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m14:13:09.737178 [info ] [Thread-1 (]: 1 of 5 OK created sql view model sales_analysis.avg_products_per_order_2023 .... [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m14:13:09.737451 [info ] [Thread-4 (]: 4 of 5 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m14:13:09.737832 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m14:13:09.738121 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m14:13:09.738360 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m14:13:10.320259 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:de246e6b-e6e5-4d79-9fea-c0d1ab974036&page=queryresults
[0m14:13:10.697524 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2f14f262-6041-4499-9051-d11c8680d44a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166cb3010>]}
[0m14:13:10.698777 [info ] [Thread-2 (]: 5 of 5 OK created sql view model sales_analysis.orders_with_products_2022_2023 . [[32mCREATE VIEW (0 processed)[0m in 1.16s]
[0m14:13:10.699866 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:13:10.701688 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:13:10.702552 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:13:10.702900 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m14:13:10.703212 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_with_products_2022_2023' was properly closed.
[0m14:13:10.703504 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m14:13:10.703755 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_per_month_2023' was properly closed.
[0m14:13:10.704177 [info ] [MainThread]: 
[0m14:13:10.704503 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 4.01 seconds (4.01s).
[0m14:13:10.705832 [debug] [MainThread]: Command end result
[0m14:13:10.727721 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:13:10.730401 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:13:10.735108 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m14:13:10.735385 [info ] [MainThread]: 
[0m14:13:10.735640 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m14:13:10.735840 [info ] [MainThread]: 
[0m14:13:10.736091 [error] [MainThread]:   Database Error in model order_segments_2023 (models/order_segments_2023.sql)
  Name customer_id not found inside o2023 at [15:18]
  compiled code at target/run/salesAnalysis/models/order_segments_2023.sql
[0m14:13:10.736282 [info ] [MainThread]: 
[0m14:13:10.736487 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m14:13:10.736857 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 5.707823, "process_in_blocks": "0", "process_kernel_time": 2.475666, "process_mem_max_rss": "250003456", "process_out_blocks": "0", "process_user_time": 2.317725}
[0m14:13:10.737194 [debug] [MainThread]: Command `dbt run` failed at 14:13:10.737145 after 5.71 seconds
[0m14:13:10.737462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11227f2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105085790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x166a48e50>]}
[0m14:13:10.737680 [debug] [MainThread]: Flushing usage events
[0m14:13:11.747110 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:14:12.058224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e825d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f03fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f038d0>]}


============================== 14:14:12.061936 | 196f7acd-c244-475b-8153-18ef452f5545 ==============================
[0m14:14:12.061936 [info ] [MainThread]: Running with dbt=1.9.2
[0m14:14:12.062247 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/edou/.dbt', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:14:13.178516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158c63d10>]}
[0m14:14:13.210827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f43b50>]}
[0m14:14:13.211237 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:14:13.302834 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m14:14:13.365922 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m14:14:13.366309 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/order_segments_2023.sql
[0m14:14:13.641393 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m14:14:13.647531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1581156d0>]}
[0m14:14:13.689615 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:14:13.693755 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:14:13.706660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158b09190>]}
[0m14:14:13.706960 [info ] [MainThread]: Found 5 models, 20 data tests, 2 sources, 491 macros
[0m14:14:13.707134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030b1cd0>]}
[0m14:14:13.708083 [info ] [MainThread]: 
[0m14:14:13.708256 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:14:13.708389 [info ] [MainThread]: 
[0m14:14:13.708617 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:14:13.710514 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m14:14:13.710703 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:14:15.103831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m14:14:15.104706 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:14:15.496400 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1030b1cd0>]}
[0m14:14:15.497742 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:14:15.500570 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m14:14:15.501064 [debug] [Thread-2 (]: Began running node model.salesAnalysis.order_segments_2023
[0m14:14:15.501499 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_2023_count
[0m14:14:15.502665 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m14:14:15.502088 [info ] [Thread-1 (]: 1 of 5 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m14:14:15.503303 [info ] [Thread-2 (]: 2 of 5 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m14:14:15.503866 [info ] [Thread-3 (]: 3 of 5 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m14:14:15.504407 [info ] [Thread-4 (]: 4 of 5 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m14:14:15.504969 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m14:14:15.505512 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m14:14:15.505952 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m14:14:15.506335 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m14:14:15.506695 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m14:14:15.507031 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m14:14:15.507318 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m14:14:15.507608 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m14:14:15.516695 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:14:15.519669 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m14:14:15.522345 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m14:14:15.526117 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m14:14:15.526969 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m14:14:15.527325 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m14:14:15.533073 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m14:14:15.539619 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m14:14:15.547216 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:14:15.548962 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m14:14:15.550528 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m14:14:15.552084 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m14:14:15.552657 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m14:14:15.553008 [debug] [Thread-2 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.customers_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.customers_id = prev_orders.customers_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.customers_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m14:14:15.553265 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:14:15.553470 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:14:15.554091 [debug] [Thread-4 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m14:14:15.554546 [debug] [Thread-3 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m14:14:15.555546 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:14:15.555930 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:14:16.120181 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:6bb11bec-958c-4c83-8984-d5ce54f3fbbf&page=queryresults
[0m14:14:16.257919 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:9d57283e-c9a0-472e-99be-24471d58d8c8&page=queryresults
[0m14:14:16.331060 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:86a358ed-3da1-4a29-98ce-42c710556fc5&page=queryresults
[0m14:14:16.543455 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158ba3550>]}
[0m14:14:16.543941 [info ] [Thread-4 (]: 4 of 5 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.04s]
[0m14:14:16.544272 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m14:14:16.544497 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:14:16.544812 [info ] [Thread-4 (]: 5 of 5 START sql view model sales_analysis.orders_with_products_2022_2023 ...... [RUN]
[0m14:14:16.545085 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.orders_per_month_2023, now model.salesAnalysis.orders_with_products_2022_2023)
[0m14:14:16.545286 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_with_products_2022_2023
[0m14:14:16.547432 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:14:16.547857 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_with_products_2022_2023
[0m14:14:16.549323 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:14:16.549701 [debug] [Thread-4 (]: On model.salesAnalysis.orders_with_products_2022_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_products_2022_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_products_2022_2023`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m14:14:16.549920 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:14:16.650498 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158b26650>]}
[0m14:14:16.651223 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:6fd0dd45-c933-4a35-a053-31027820749e&page=queryresults
[0m14:14:16.651663 [info ] [Thread-1 (]: 1 of 5 OK created sql view model sales_analysis.avg_products_per_order_2023 .... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m14:14:16.652457 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m14:14:16.684788 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ad37ed0>]}
[0m14:14:16.685275 [info ] [Thread-3 (]: 3 of 5 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.18s]
[0m14:14:16.685641 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m14:14:17.031412 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15aca41d0>]}
[0m14:14:17.032543 [info ] [Thread-2 (]: 2 of 5 OK created sql view model sales_analysis.order_segments_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.53s]
[0m14:14:17.033236 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m14:14:17.211242 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:1e23a1ff-ef7e-4101-8cd6-a9ce1727ed09&page=queryresults
[0m14:14:17.600588 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '196f7acd-c244-475b-8153-18ef452f5545', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1597c6b10>]}
[0m14:14:17.601587 [info ] [Thread-4 (]: 5 of 5 OK created sql view model sales_analysis.orders_with_products_2022_2023 . [[32mCREATE VIEW (0 processed)[0m in 1.06s]
[0m14:14:17.602234 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:14:17.603909 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:14:17.604659 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:14:17.605013 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m14:14:17.605327 [debug] [MainThread]: Connection 'model.salesAnalysis.order_segments_2023' was properly closed.
[0m14:14:17.605614 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_count' was properly closed.
[0m14:14:17.605893 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_with_products_2022_2023' was properly closed.
[0m14:14:17.606344 [info ] [MainThread]: 
[0m14:14:17.606688 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 3.90 seconds (3.90s).
[0m14:14:17.608078 [debug] [MainThread]: Command end result
[0m14:14:17.632323 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:14:17.633859 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:14:17.637860 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m14:14:17.638083 [info ] [MainThread]: 
[0m14:14:17.638327 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:14:17.638498 [info ] [MainThread]: 
[0m14:14:17.638690 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
[0m14:14:17.639014 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.6194596, "process_in_blocks": "0", "process_kernel_time": 2.43297, "process_mem_max_rss": "248840192", "process_out_blocks": "0", "process_user_time": 2.396288}
[0m14:14:17.639331 [debug] [MainThread]: Command `dbt run` succeeded at 14:14:17.639283 after 5.62 seconds
[0m14:14:17.639590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f24410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10101bcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10101bb90>]}
[0m14:14:17.639809 [debug] [MainThread]: Flushing usage events
[0m14:14:18.688994 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m14:17:26.421370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a83310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af6c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a821d0>]}


============================== 14:17:26.425024 | 080c01db-d4fb-4718-8e52-39d49a536e8d ==============================
[0m14:17:26.425024 [info ] [MainThread]: Running with dbt=1.9.2
[0m14:17:26.425335 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'profiles_dir': '/Users/edou/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:17:27.524406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15c766690>]}
[0m14:17:27.555135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c48750>]}
[0m14:17:27.555477 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m14:17:27.646423 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m14:17:27.711573 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 2 files added, 0 files changed.
[0m14:17:27.712299 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_2023_with_segments.sql
[0m14:17:27.712504 [debug] [MainThread]: Partial parsing: added file: salesAnalysis://models/orders_2023_with_segments.yml
[0m14:17:27.985824 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m14:17:27.991985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca2e610>]}
[0m14:17:28.036380 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:17:28.040523 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:17:28.054878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cd4e50>]}
[0m14:17:28.055181 [info ] [MainThread]: Found 6 models, 27 data tests, 2 sources, 491 macros
[0m14:17:28.055351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165840710>]}
[0m14:17:28.056372 [info ] [MainThread]: 
[0m14:17:28.056551 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:17:28.056685 [info ] [MainThread]: 
[0m14:17:28.056923 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m14:17:28.058881 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m14:17:28.059070 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:17:29.534949 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m14:17:29.536051 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:17:29.940408 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15ca710d0>]}
[0m14:17:29.941554 [debug] [MainThread]: Opening a new connection, currently in state init
[0m14:17:29.944482 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_products_per_order_2023
[0m14:17:29.945009 [debug] [Thread-2 (]: Began running node model.salesAnalysis.order_segments_2023
[0m14:17:29.946031 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_2023_count
[0m14:17:29.945662 [info ] [Thread-1 (]: 1 of 6 START sql view model sales_analysis.avg_products_per_order_2023 ......... [RUN]
[0m14:17:29.946741 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_per_month_2023
[0m14:17:29.947291 [info ] [Thread-2 (]: 2 of 6 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m14:17:29.948034 [info ] [Thread-3 (]: 3 of 6 START sql view model sales_analysis.orders_2023_count ................... [RUN]
[0m14:17:29.948676 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_products_per_order_2023)
[0m14:17:29.949142 [info ] [Thread-4 (]: 4 of 6 START sql view model sales_analysis.orders_per_month_2023 ............... [RUN]
[0m14:17:29.949663 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m14:17:29.950088 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_2023_count'
[0m14:17:29.950436 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_products_per_order_2023
[0m14:17:29.950870 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_per_month_2023'
[0m14:17:29.951185 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m14:17:29.951483 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_2023_count
[0m14:17:29.961188 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:17:29.961820 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_per_month_2023
[0m14:17:29.966634 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m14:17:29.968857 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_count"
[0m14:17:29.971503 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_per_month_2023"
[0m14:17:29.971967 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_products_per_order_2023
[0m14:17:29.978572 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m14:17:29.991191 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_products_per_order_2023"
[0m14:17:29.993107 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m14:17:29.993360 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_2023_count
[0m14:17:29.993567 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_per_month_2023
[0m14:17:29.995380 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_count"
[0m14:17:29.996979 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_per_month_2023"
[0m14:17:29.997277 [debug] [Thread-1 (]: On model.salesAnalysis.avg_products_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_products_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_products_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m14:17:29.997573 [debug] [Thread-2 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.customers_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.customers_id = prev_orders.customers_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.customers_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m14:17:29.998020 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:17:29.998244 [debug] [Thread-3 (]: On model.salesAnalysis.orders_2023_count: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_count"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_count`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m14:17:29.998477 [debug] [Thread-4 (]: On model.salesAnalysis.orders_per_month_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_per_month_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_per_month_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m14:17:29.998707 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:17:29.999514 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:17:29.999789 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:17:30.689951 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:76a98454-d291-4923-bcbe-fdec67b4626d&page=queryresults
[0m14:17:30.693515 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:743954a1-d040-40b3-b3a6-ed4e746352fa&page=queryresults
[0m14:17:30.694528 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:56787d4d-acfb-4ae8-b8a7-e370871f5ad8&page=queryresults
[0m14:17:30.722895 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:a07e8102-d3ce-4f64-910d-b12034733c70&page=queryresults
[0m14:17:31.106794 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d180f90>]}
[0m14:17:31.107051 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x165d0c450>]}
[0m14:17:31.107267 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1658f00d0>]}
[0m14:17:31.107488 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15d1b8650>]}
[0m14:17:31.107949 [info ] [Thread-3 (]: 3 of 6 OK created sql view model sales_analysis.orders_2023_count .............. [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m14:17:31.108341 [info ] [Thread-4 (]: 4 of 6 OK created sql view model sales_analysis.orders_per_month_2023 .......... [[32mCREATE VIEW (0 processed)[0m in 1.15s]
[0m14:17:31.108675 [info ] [Thread-1 (]: 1 of 6 OK created sql view model sales_analysis.avg_products_per_order_2023 .... [[32mCREATE VIEW (0 processed)[0m in 1.16s]
[0m14:17:31.108971 [info ] [Thread-2 (]: 2 of 6 OK created sql view model sales_analysis.order_segments_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.16s]
[0m14:17:31.109271 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_2023_count
[0m14:17:31.109523 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_per_month_2023
[0m14:17:31.109757 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_products_per_order_2023
[0m14:17:31.110009 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m14:17:31.110214 [debug] [Thread-3 (]: Began running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:17:31.110696 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_2023_with_segments
[0m14:17:31.110926 [info ] [Thread-3 (]: 5 of 6 START sql view model sales_analysis.orders_with_products_2022_2023 ...... [RUN]
[0m14:17:31.111165 [info ] [Thread-4 (]: 6 of 6 START sql view model sales_analysis.orders_2023_with_segments ........... [RUN]
[0m14:17:31.111401 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.orders_2023_count, now model.salesAnalysis.orders_with_products_2022_2023)
[0m14:17:31.111602 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.orders_per_month_2023, now model.salesAnalysis.orders_2023_with_segments)
[0m14:17:31.111784 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.orders_with_products_2022_2023
[0m14:17:31.111975 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_2023_with_segments
[0m14:17:31.114124 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:17:31.116259 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_2023_with_segments"
[0m14:17:31.117056 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_2023_with_segments
[0m14:17:31.117293 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.orders_with_products_2022_2023
[0m14:17:31.118805 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_2023_with_segments"
[0m14:17:31.120294 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_products_2022_2023"
[0m14:17:31.120989 [debug] [Thread-4 (]: On model.salesAnalysis.orders_2023_with_segments: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_2023_with_segments"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_2023_with_segments`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        o.orders_id,
        o.date_date,
        o.customers_id,
        COUNT(DISTINCT s.products_id) as qty_products
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date, o.customers_id
)

SELECT 
    o.orders_id,
    o.date_date,
    o.qty_products,
    seg.segment
FROM orders_2023 o
LEFT JOIN `salesanalysis-450811`.`sales_analysis`.`order_segments_2023` seg
    ON o.orders_id = seg.orders_id
ORDER BY o.date_date, o.orders_id;


[0m14:17:31.121319 [debug] [Thread-3 (]: On model.salesAnalysis.orders_with_products_2022_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_products_2022_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_products_2022_2023`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m14:17:31.121574 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:17:31.121803 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:17:31.813776 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:30363711-46be-4b64-a62c-70cae2d7fe46&page=queryresults
[0m14:17:31.946177 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:fbea07f2-8b48-4f15-800e-f14623f7167f&page=queryresults
[0m14:17:32.164770 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cb66010>]}
[0m14:17:32.165426 [info ] [Thread-3 (]: 5 of 6 OK created sql view model sales_analysis.orders_with_products_2022_2023 . [[32mCREATE VIEW (0 processed)[0m in 1.05s]
[0m14:17:32.165900 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.orders_with_products_2022_2023
[0m14:17:32.339741 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '080c01db-d4fb-4718-8e52-39d49a536e8d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x15cd7d890>]}
[0m14:17:32.340311 [info ] [Thread-4 (]: 6 of 6 OK created sql view model sales_analysis.orders_2023_with_segments ...... [[32mCREATE VIEW (0 processed)[0m in 1.23s]
[0m14:17:32.340728 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_2023_with_segments
[0m14:17:32.341778 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m14:17:32.342247 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:17:32.342441 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_products_per_order_2023' was properly closed.
[0m14:17:32.342590 [debug] [MainThread]: Connection 'model.salesAnalysis.order_segments_2023' was properly closed.
[0m14:17:32.342873 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_with_products_2022_2023' was properly closed.
[0m14:17:32.343079 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_2023_with_segments' was properly closed.
[0m14:17:32.343304 [info ] [MainThread]: 
[0m14:17:32.343532 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.29 seconds (4.29s).
[0m14:17:32.344539 [debug] [MainThread]: Command end result
[0m14:17:32.364366 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m14:17:32.365766 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m14:17:32.369058 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m14:17:32.369284 [info ] [MainThread]: 
[0m14:17:32.369547 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:17:32.369704 [info ] [MainThread]: 
[0m14:17:32.369867 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m14:17:32.370175 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.9868684, "process_in_blocks": "0", "process_kernel_time": 2.41566, "process_mem_max_rss": "245268480", "process_out_blocks": "0", "process_user_time": 2.383662}
[0m14:17:32.370458 [debug] [MainThread]: Command `dbt run` succeeded at 14:17:32.370419 after 5.99 seconds
[0m14:17:32.370675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d13cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d13b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c95ad0>]}
[0m14:17:32.370864 [debug] [MainThread]: Flushing usage events
[0m14:17:33.822736 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:01:38.000748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123825d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123f5490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112403e50>]}


============================== 01:01:38.004995 | 9eb1824c-230a-49d0-8124-c6b89a0c5581 ==============================
[0m01:01:38.004995 [info ] [MainThread]: Running with dbt=1.9.2
[0m01:01:38.005495 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'debug': 'False', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:01:44.240591 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17d2f14d0>]}
[0m01:01:44.274250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c37490>]}
[0m01:01:44.274734 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:01:44.665031 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m01:01:44.665796 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m01:01:44.666071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17d353090>]}
[0m01:01:45.262519 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'orders_2023_count' in the 'models' section of file 'models/total_orders_2023.yml'
[0m01:01:45.335108 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'avg_products_per_order_2023' in the 'models' section of file 'models/avg_prods_per_order_2023.yml'
[0m01:01:45.343052 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'orders_per_month_2023' in the 'models' section of file 'models/monthly_orders_2023.yml'
[0m01:01:45.348881 [warn ] [MainThread]: [[33mWARNING[0m]: Did not find matching node for patch with name 'orders_2023_with_segments' in the 'models' section of file 'models/2023_orders_with_segments.yml'
[0m01:01:45.367884 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_2023_count_total_orders_2023.9516e9932f' (models/total_orders_2023.yml) depends on a node named 'orders_2023_count' in package '' which was not found
[0m01:01:45.368207 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.positive_value_orders_2023_count_total_orders_2023.e4868b3306' (models/total_orders_2023.yml) depends on a node named 'orders_2023_count' in package '' which was not found
[0m01:01:45.368387 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_avg_products_per_order_2023_month.431fe789b7' (models/avg_prods_per_order_2023.yml) depends on a node named 'avg_products_per_order_2023' in package '' which was not found
[0m01:01:45.368557 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.accepted_values_avg_products_per_order_2023_month__1__2__3__4__5__6__7__8__9__10__11__12.5ca8f5e406' (models/avg_prods_per_order_2023.yml) depends on a node named 'avg_products_per_order_2023' in package '' which was not found
[0m01:01:45.368727 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_avg_products_per_order_2023_avg_products_per_order.ca97335b00' (models/avg_prods_per_order_2023.yml) depends on a node named 'avg_products_per_order_2023' in package '' which was not found
[0m01:01:45.368877 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.positive_value_avg_products_per_order_2023_avg_products_per_order.b5f92a6d20' (models/avg_prods_per_order_2023.yml) depends on a node named 'avg_products_per_order_2023' in package '' which was not found
[0m01:01:45.369026 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_per_month_2023_month.84debb60e3' (models/monthly_orders_2023.yml) depends on a node named 'orders_per_month_2023' in package '' which was not found
[0m01:01:45.369179 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.accepted_values_orders_per_month_2023_month__1__2__3__4__5__6__7__8__9__10__11__12.d71cc55570' (models/monthly_orders_2023.yml) depends on a node named 'orders_per_month_2023' in package '' which was not found
[0m01:01:45.369325 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_per_month_2023_orders_count.fd64903078' (models/monthly_orders_2023.yml) depends on a node named 'orders_per_month_2023' in package '' which was not found
[0m01:01:45.369472 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.positive_value_orders_per_month_2023_orders_count.e95980725c' (models/monthly_orders_2023.yml) depends on a node named 'orders_per_month_2023' in package '' which was not found
[0m01:01:45.369607 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_2023_with_segments_orders_id.f9dff16bb5' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.369760 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.unique_orders_2023_with_segments_orders_id.9c7adff559' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.369895 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_2023_with_segments_date_date.ee236a67a8' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.370035 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_2023_with_segments_qty_products.2102d2f99c' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.370174 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.positive_value_orders_2023_with_segments_qty_products.57d646a264' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.370314 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.not_null_orders_2023_with_segments_segment.8417592514' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.370455 [warn ] [MainThread]: [[33mWARNING[0m]: Test 'test.salesAnalysis.accepted_values_orders_2023_with_segments_segment__New__Returning__VIP.cc09bc8855' (models/2023_orders_with_segments.yml) depends on a node named 'orders_2023_with_segments' in package '' which was not found
[0m01:01:45.412235 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m01:01:45.418273 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17ebb0510>]}
[0m01:01:45.464271 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:01:45.468161 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:01:45.482110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17eccfd50>]}
[0m01:01:45.482465 [info ] [MainThread]: Found 6 models, 10 data tests, 2 sources, 491 macros
[0m01:01:45.482648 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17ebb5d90>]}
[0m01:01:45.483721 [info ] [MainThread]: 
[0m01:01:45.483917 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:01:45.484121 [info ] [MainThread]: 
[0m01:01:45.484391 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:01:45.486403 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m01:01:45.486718 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:01:47.587900 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m01:01:47.588376 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:01:47.979938 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17d5b9d10>]}
[0m01:01:47.981319 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:01:47.984156 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_prods_per_order_2023
[0m01:01:47.984663 [debug] [Thread-2 (]: Began running node model.salesAnalysis.monthly_orders_2023
[0m01:01:47.985165 [debug] [Thread-3 (]: Began running node model.salesAnalysis.order_segments_2023
[0m01:01:47.985629 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_with_prods
[0m01:01:47.986323 [info ] [Thread-1 (]: 1 of 6 START sql view model sales_analysis.avg_prods_per_order_2023 ............ [RUN]
[0m01:01:47.986930 [info ] [Thread-2 (]: 2 of 6 START sql view model sales_analysis.monthly_orders_2023 ................. [RUN]
[0m01:01:47.987566 [info ] [Thread-3 (]: 3 of 6 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m01:01:47.988083 [info ] [Thread-4 (]: 4 of 6 START sql view model sales_analysis.orders_with_prods ................... [RUN]
[0m01:01:47.988642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_prods_per_order_2023)
[0m01:01:47.989142 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.monthly_orders_2023'
[0m01:01:47.989760 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m01:01:47.990170 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_with_prods'
[0m01:01:47.990516 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_prods_per_order_2023
[0m01:01:47.990837 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.monthly_orders_2023
[0m01:01:47.991140 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m01:01:47.991436 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_with_prods
[0m01:01:48.001937 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_prods_per_order_2023"
[0m01:01:48.004362 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.monthly_orders_2023"
[0m01:01:48.007271 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m01:01:48.009677 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_prods"
[0m01:01:48.011011 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m01:01:48.011374 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_with_prods
[0m01:01:48.011607 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_prods_per_order_2023
[0m01:01:48.011876 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.monthly_orders_2023
[0m01:01:48.031908 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m01:01:48.033674 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_prods"
[0m01:01:48.035205 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_prods_per_order_2023"
[0m01:01:48.036709 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.monthly_orders_2023"
[0m01:01:48.037673 [debug] [Thread-2 (]: On model.salesAnalysis.monthly_orders_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.monthly_orders_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`monthly_orders_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m01:01:48.038015 [debug] [Thread-4 (]: On model.salesAnalysis.orders_with_prods: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_prods"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m01:01:48.038316 [debug] [Thread-3 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.customers_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.customers_id = prev_orders.customers_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.customers_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m01:01:48.038689 [debug] [Thread-1 (]: On model.salesAnalysis.avg_prods_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_prods_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_prods_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m01:01:48.038963 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:01:48.039325 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:01:48.039607 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:01:48.039883 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:01:48.735344 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2e2070c6-8d6f-41cc-aaff-9b186074fdf5&page=queryresults
[0m01:01:48.867389 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:b040ac82-23a2-43ff-b26b-db2a9ab4a618&page=queryresults
[0m01:01:48.879605 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:bb180854-71f5-42d7-a8ac-d9440770d90d&page=queryresults
[0m01:01:48.886167 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:b1fbbc79-2c64-40ea-a5e4-35e5ae746280&page=queryresults
[0m01:01:49.314572 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17ebc8c10>]}
[0m01:01:49.314869 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17d4ca710>]}
[0m01:01:49.315454 [info ] [Thread-1 (]: 1 of 6 OK created sql view model sales_analysis.avg_prods_per_order_2023 ....... [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m01:01:49.315999 [info ] [Thread-2 (]: 2 of 6 OK created sql view model sales_analysis.monthly_orders_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.32s]
[0m01:01:49.316448 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_prods_per_order_2023
[0m01:01:49.316744 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.monthly_orders_2023
[0m01:01:49.316978 [debug] [Thread-1 (]: Began running node model.salesAnalysis.total_orders_2023
[0m01:01:49.317408 [info ] [Thread-1 (]: 5 of 6 START sql view model sales_analysis.total_orders_2023 ................... [RUN]
[0m01:01:49.317713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.avg_prods_per_order_2023, now model.salesAnalysis.total_orders_2023)
[0m01:01:49.317928 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.total_orders_2023
[0m01:01:49.321000 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.total_orders_2023"
[0m01:01:49.321521 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.total_orders_2023
[0m01:01:49.323254 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.total_orders_2023"
[0m01:01:49.323628 [debug] [Thread-1 (]: On model.salesAnalysis.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.total_orders_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`total_orders_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m01:01:49.323842 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:01:49.415864 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17ecb2a50>]}
[0m01:01:49.417240 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17d4caa50>]}
[0m01:01:49.417896 [info ] [Thread-4 (]: 4 of 6 OK created sql view model sales_analysis.orders_with_prods .............. [[32mCREATE VIEW (0 processed)[0m in 1.43s]
[0m01:01:49.418357 [info ] [Thread-3 (]: 3 of 6 OK created sql view model sales_analysis.order_segments_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.43s]
[0m01:01:49.418728 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_with_prods
[0m01:01:49.419028 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m01:01:49.419451 [debug] [Thread-2 (]: Began running node model.salesAnalysis.2023_orders_with_segments
[0m01:01:49.419782 [info ] [Thread-2 (]: 6 of 6 START sql view model sales_analysis.2023_orders_with_segments ........... [RUN]
[0m01:01:49.420123 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.monthly_orders_2023, now model.salesAnalysis.2023_orders_with_segments)
[0m01:01:49.420416 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.2023_orders_with_segments
[0m01:01:49.422916 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.2023_orders_with_segments"
[0m01:01:49.423480 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.2023_orders_with_segments
[0m01:01:49.425441 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.2023_orders_with_segments"
[0m01:01:49.426059 [debug] [Thread-2 (]: On model.salesAnalysis.2023_orders_with_segments: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.2023_orders_with_segments"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`2023_orders_with_segments`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        o.orders_id,
        o.date_date,
        o.customers_id,
        COUNT(DISTINCT s.products_id) as qty_products
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date, o.customers_id
)

SELECT 
    o.orders_id,
    o.date_date,
    o.qty_products,
    seg.segment
FROM orders_2023 o
LEFT JOIN `salesanalysis-450811`.`sales_analysis`.`order_segments_2023` seg
    ON o.orders_id = seg.orders_id
ORDER BY o.date_date, o.orders_id;


[0m01:01:49.426352 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:01:49.975753 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:404910dc-ef4d-44ef-8ca5-d86f3b9447ec&page=queryresults
[0m01:01:50.251389 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:78a092f1-1fbf-437b-b414-9ba2ad77141b&page=queryresults
[0m01:01:50.313901 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17ebd9750>]}
[0m01:01:50.314495 [info ] [Thread-1 (]: 5 of 6 OK created sql view model sales_analysis.total_orders_2023 .............. [[32mCREATE VIEW (0 processed)[0m in 1.00s]
[0m01:01:50.314899 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.total_orders_2023
[0m01:01:50.775006 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9eb1824c-230a-49d0-8124-c6b89a0c5581', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16f711950>]}
[0m01:01:50.776334 [info ] [Thread-2 (]: 6 of 6 OK created sql view model sales_analysis.2023_orders_with_segments ...... [[32mCREATE VIEW (0 processed)[0m in 1.35s]
[0m01:01:50.777403 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.2023_orders_with_segments
[0m01:01:50.779341 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:01:50.780075 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:01:50.780439 [debug] [MainThread]: Connection 'model.salesAnalysis.total_orders_2023' was properly closed.
[0m01:01:50.780757 [debug] [MainThread]: Connection 'model.salesAnalysis.2023_orders_with_segments' was properly closed.
[0m01:01:50.781056 [debug] [MainThread]: Connection 'model.salesAnalysis.order_segments_2023' was properly closed.
[0m01:01:50.781341 [debug] [MainThread]: Connection 'model.salesAnalysis.orders_with_prods' was properly closed.
[0m01:01:50.781932 [info ] [MainThread]: 
[0m01:01:50.782480 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 5.30 seconds (5.30s).
[0m01:01:50.784004 [debug] [MainThread]: Command end result
[0m01:01:50.808883 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:01:50.810389 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:01:50.814666 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m01:01:50.814907 [info ] [MainThread]: 
[0m01:01:50.815165 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:01:50.815337 [info ] [MainThread]: 
[0m01:01:50.815598 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m01:01:50.815987 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 12.872717, "process_in_blocks": "0", "process_kernel_time": 1.850239, "process_mem_max_rss": "244350976", "process_out_blocks": "0", "process_user_time": 3.964017}
[0m01:01:50.816340 [debug] [MainThread]: Command `dbt run` succeeded at 01:01:50.816289 after 12.87 seconds
[0m01:01:50.816604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f63cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f63b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ee5ad0>]}
[0m01:01:50.816828 [debug] [MainThread]: Flushing usage events
[0m01:01:52.125366 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:02:01.024345 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075825d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107607ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107607fd0>]}


============================== 01:02:01.028789 | 67e3490e-20b1-45c5-b1fc-59855e403c39 ==============================
[0m01:02:01.028789 [info ] [MainThread]: Running with dbt=1.9.2
[0m01:02:01.029246 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt test', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m01:02:01.949991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '67e3490e-20b1-45c5-b1fc-59855e403c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107614450>]}
[0m01:02:01.982546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '67e3490e-20b1-45c5-b1fc-59855e403c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104840a90>]}
[0m01:02:01.982992 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:02:02.076793 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m01:02:02.145680 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:02:02.145963 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:02:02.149796 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m01:02:02.188935 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '67e3490e-20b1-45c5-b1fc-59855e403c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x168916bd0>]}
[0m01:02:02.273395 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:02:02.277830 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:02:02.300426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '67e3490e-20b1-45c5-b1fc-59855e403c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169e1f350>]}
[0m01:02:02.300808 [info ] [MainThread]: Found 6 models, 10 data tests, 2 sources, 491 macros
[0m01:02:02.300986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67e3490e-20b1-45c5-b1fc-59855e403c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169ab3550>]}
[0m01:02:02.302118 [info ] [MainThread]: 
[0m01:02:02.302302 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:02:02.302440 [info ] [MainThread]: 
[0m01:02:02.302711 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:02:02.304677 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811_sales_analysis'
[0m01:02:02.304858 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:02:03.601188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '67e3490e-20b1-45c5-b1fc-59855e403c39', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x169bf0110>]}
[0m01:02:03.602298 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:02:03.604701 [debug] [Thread-1 (]: Began running node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:02:03.605325 [debug] [Thread-2 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:02:03.605780 [debug] [Thread-3 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:02:03.606222 [info ] [Thread-1 (]: 1 of 10 START test accepted_values_order_segments_2023_segment__New__Returning__VIP  [RUN]
[0m01:02:03.606695 [debug] [Thread-4 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:02:03.607148 [info ] [Thread-2 (]: 2 of 10 START test not_null_order_segments_2023_date_date ...................... [RUN]
[0m01:02:03.607589 [info ] [Thread-3 (]: 3 of 10 START test not_null_order_segments_2023_orders_id ...................... [RUN]
[0m01:02:03.608146 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f)
[0m01:02:03.608507 [info ] [Thread-4 (]: 4 of 10 START test not_null_order_segments_2023_segment ........................ [RUN]
[0m01:02:03.609081 [debug] [Thread-2 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c'
[0m01:02:03.609600 [debug] [Thread-3 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67'
[0m01:02:03.610009 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:02:03.610394 [debug] [Thread-4 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32'
[0m01:02:03.610677 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:02:03.610947 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:02:03.630255 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"
[0m01:02:03.630654 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:02:03.636344 [debug] [Thread-2 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"
[0m01:02:03.639561 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"
[0m01:02:03.642744 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"
[0m01:02:03.643440 [debug] [Thread-2 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:02:03.643798 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:02:03.656066 [debug] [Thread-2 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"
[0m01:02:03.717291 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:02:03.718601 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"
[0m01:02:03.718837 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:02:03.720128 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"
[0m01:02:03.721426 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"
[0m01:02:03.721798 [debug] [Thread-2 (]: On test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_date
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where date_date is null



      
    ) dbt_internal_test
[0m01:02:03.722105 [debug] [Thread-1 (]: On test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        segment as value_field,
        count(*) as n_records

    from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
    group by segment

)

select *
from all_values
where value_field not in (
    'New','Returning','VIP'
)



      
    ) dbt_internal_test
[0m01:02:03.722381 [debug] [Thread-3 (]: On test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select orders_id
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where orders_id is null



      
    ) dbt_internal_test
[0m01:02:03.722601 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:02:03.722761 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:02:03.722979 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:02:03.723793 [debug] [Thread-4 (]: On test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select segment
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where segment is null



      
    ) dbt_internal_test
[0m01:02:03.725371 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:02:05.028858 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2ba8ba08-9ed0-48bf-a5a7-fb670f52aaf6&page=queryresults
[0m01:02:05.061595 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:a2562750-ff50-4928-be60-b0e8f9a28f26&page=queryresults
[0m01:02:05.225358 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:bb06c52f-a997-4803-8662-796cb947b56a&page=queryresults
[0m01:02:05.227038 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f7cac3c5-08ae-45e3-ad15-d2dc2643f720&page=queryresults
[0m01:02:05.688903 [info ] [Thread-2 (]: 2 of 10 PASS not_null_order_segments_2023_date_date ............................ [[32mPASS[0m in 2.08s]
[0m01:02:05.689617 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:02:05.689931 [debug] [Thread-2 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:02:05.690177 [info ] [Thread-2 (]: 5 of 10 START test not_null_orders_with_prods_date_date ........................ [RUN]
[0m01:02:05.690840 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c, now test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4)
[0m01:02:05.691081 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:02:05.693599 [debug] [Thread-2 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"
[0m01:02:05.696192 [info ] [Thread-3 (]: 3 of 10 PASS not_null_order_segments_2023_orders_id ............................ [[32mPASS[0m in 2.09s]
[0m01:02:05.697029 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:02:05.697441 [debug] [Thread-3 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:02:05.697917 [info ] [Thread-3 (]: 6 of 10 START test not_null_orders_with_prods_orders_id ........................ [RUN]
[0m01:02:05.698341 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67, now test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109)
[0m01:02:05.698690 [debug] [Thread-2 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:02:05.698992 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:02:05.701338 [debug] [Thread-2 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"
[0m01:02:05.704272 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"
[0m01:02:05.705280 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:02:05.705591 [debug] [Thread-2 (]: On test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_date
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where date_date is null



      
    ) dbt_internal_test
[0m01:02:05.707817 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"
[0m01:02:05.708347 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:02:05.710823 [debug] [Thread-3 (]: On test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select orders_id
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where orders_id is null



      
    ) dbt_internal_test
[0m01:02:05.711426 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:02:05.820115 [info ] [Thread-1 (]: 1 of 10 PASS accepted_values_order_segments_2023_segment__New__Returning__VIP .. [[32mPASS[0m in 2.21s]
[0m01:02:05.820762 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:02:05.821074 [debug] [Thread-1 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:02:05.821345 [info ] [Thread-1 (]: 7 of 10 START test not_null_orders_with_prods_qty_product ...................... [RUN]
[0m01:02:05.821734 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f, now test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a)
[0m01:02:05.822051 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:02:05.825495 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"
[0m01:02:05.827841 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:02:05.829272 [info ] [Thread-4 (]: 4 of 10 PASS not_null_order_segments_2023_segment .............................. [[32mPASS[0m in 2.22s]
[0m01:02:05.831464 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"
[0m01:02:05.831910 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:02:05.832407 [debug] [Thread-4 (]: Began running node test.salesAnalysis.positive_value_orders_with_prods_qty_product.b336c35b76
[0m01:02:05.832761 [info ] [Thread-4 (]: 8 of 10 START test positive_value_orders_with_prods_qty_product ................ [RUN]
[0m01:02:05.833213 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32, now test.salesAnalysis.positive_value_orders_with_prods_qty_product.b336c35b76)
[0m01:02:05.833503 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.positive_value_orders_with_prods_qty_product.b336c35b76
[0m01:02:05.836407 [debug] [Thread-1 (]: On test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select qty_product
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where qty_product is null



      
    ) dbt_internal_test
[0m01:02:05.836867 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:02:05.838131 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:02:05.843369 [debug] [Thread-4 (]: Compilation Error in test positive_value_orders_with_prods_qty_product (models/orders_with_prods.yml)
  'test_positive_value' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m01:02:05.843770 [error] [Thread-4 (]: 8 of 10 ERROR positive_value_orders_with_prods_qty_product ..................... [[31mERROR[0m in 0.01s]
[0m01:02:05.844078 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.positive_value_orders_with_prods_qty_product.b336c35b76
[0m01:02:05.844299 [debug] [Thread-4 (]: Began running node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:02:05.844637 [debug] [Thread-7 (]: Marking all children of 'test.salesAnalysis.positive_value_orders_with_prods_qty_product.b336c35b76' to be skipped because of status 'error'.  Reason: Compilation Error in test positive_value_orders_with_prods_qty_product (models/orders_with_prods.yml)
  'test_positive_value' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m01:02:05.844998 [info ] [Thread-4 (]: 9 of 10 START test unique_order_segments_2023_orders_id ........................ [RUN]
[0m01:02:05.845663 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.positive_value_orders_with_prods_qty_product.b336c35b76, now test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081)
[0m01:02:05.845935 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:02:05.849770 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"
[0m01:02:05.850235 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:02:05.851660 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"
[0m01:02:05.852396 [debug] [Thread-4 (]: On test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select orders_id as unique_field
  from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  where orders_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m01:02:05.852762 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:02:07.026135 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f46c30a7-b34a-41d3-a5bd-7fae3cab3214&page=queryresults
[0m01:02:07.324265 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:0de20caa-44e0-4bf3-849f-ab1d8b60b027&page=queryresults
[0m01:02:07.385195 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:4da0f3ab-a91e-4cd5-9222-695e40c92750&page=queryresults
[0m01:02:07.460733 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:7a3db975-66d7-43db-983b-034f23e6cd60&page=queryresults
[0m01:02:07.677406 [info ] [Thread-3 (]: 6 of 10 PASS not_null_orders_with_prods_orders_id .............................. [[32mPASS[0m in 1.98s]
[0m01:02:07.679213 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:02:07.679845 [debug] [Thread-3 (]: Began running node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:02:07.680493 [info ] [Thread-3 (]: 10 of 10 START test unique_orders_with_prods_orders_id ......................... [RUN]
[0m01:02:07.681017 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109, now test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d)
[0m01:02:07.681494 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:02:07.685872 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"
[0m01:02:07.686847 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:02:07.689340 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"
[0m01:02:07.690105 [debug] [Thread-3 (]: On test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select orders_id as unique_field
  from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
  where orders_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m01:02:07.690532 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:02:07.969173 [info ] [Thread-4 (]: 9 of 10 PASS unique_order_segments_2023_orders_id .............................. [[32mPASS[0m in 2.12s]
[0m01:02:07.970349 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:02:08.068104 [info ] [Thread-1 (]: 7 of 10 PASS not_null_orders_with_prods_qty_product ............................ [[32mPASS[0m in 2.25s]
[0m01:02:08.068803 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:02:08.123154 [info ] [Thread-2 (]: 5 of 10 PASS not_null_orders_with_prods_date_date .............................. [[32mPASS[0m in 2.43s]
[0m01:02:08.123989 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:02:08.922063 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2b03d049-e118-4c71-ba8a-cb3cda4fc8bc&page=queryresults
[0m01:02:09.552522 [info ] [Thread-3 (]: 10 of 10 PASS unique_orders_with_prods_orders_id ............................... [[32mPASS[0m in 1.87s]
[0m01:02:09.553682 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:02:09.555757 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:02:09.556701 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:02:09.557065 [debug] [MainThread]: Connection 'test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a' was properly closed.
[0m01:02:09.557392 [debug] [MainThread]: Connection 'test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4' was properly closed.
[0m01:02:09.557719 [debug] [MainThread]: Connection 'test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d' was properly closed.
[0m01:02:09.558010 [debug] [MainThread]: Connection 'test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081' was properly closed.
[0m01:02:09.558382 [info ] [MainThread]: 
[0m01:02:09.558743 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 7.26 seconds (7.26s).
[0m01:02:09.560929 [debug] [MainThread]: Command end result
[0m01:02:09.587701 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:02:09.589609 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:02:09.594474 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m01:02:09.594805 [info ] [MainThread]: 
[0m01:02:09.595049 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:02:09.595244 [info ] [MainThread]: 
[0m01:02:09.595531 [error] [MainThread]:   Compilation Error in test positive_value_orders_with_prods_qty_product (models/orders_with_prods.yml)
  'test_positive_value' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m01:02:09.595756 [info ] [MainThread]: 
[0m01:02:09.595965 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 TOTAL=10
[0m01:02:09.596297 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 8.615767, "process_in_blocks": "0", "process_kernel_time": 2.241664, "process_mem_max_rss": "246333440", "process_out_blocks": "0", "process_user_time": 2.473657}
[0m01:02:09.596626 [debug] [MainThread]: Command `dbt test` failed at 01:02:09.596575 after 8.62 seconds
[0m01:02:09.596925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10757f550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c3d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c3d750>]}
[0m01:02:09.597212 [debug] [MainThread]: Flushing usage events
[0m01:02:10.432654 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:03:14.234384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e822d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e83a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112807f90>]}


============================== 01:03:14.238596 | 3f6c6c28-5044-49bc-872d-902148a3a305 ==============================
[0m01:03:14.238596 [info ] [MainThread]: Running with dbt=1.9.2
[0m01:03:14.239088 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m01:03:15.450887 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16eb653d0>]}
[0m01:03:15.485302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106933c10>]}
[0m01:03:15.485756 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:03:15.579228 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m01:03:15.649274 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:03:15.650549 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/orders_with_prods.yml
[0m01:03:15.947180 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m01:03:15.953030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bceae90>]}
[0m01:03:15.996682 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:03:16.001001 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:03:16.014861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111da390>]}
[0m01:03:16.015205 [info ] [MainThread]: Found 6 models, 10 data tests, 2 sources, 491 macros
[0m01:03:16.015385 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bbb8210>]}
[0m01:03:16.016356 [info ] [MainThread]: 
[0m01:03:16.016528 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:03:16.016659 [info ] [MainThread]: 
[0m01:03:16.016898 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:03:16.019198 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m01:03:16.019483 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:03:17.431503 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m01:03:17.432198 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m01:03:17.843907 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e7b250>]}
[0m01:03:17.844547 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:03:17.847446 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_prods_per_order_2023
[0m01:03:17.848148 [debug] [Thread-2 (]: Began running node model.salesAnalysis.monthly_orders_2023
[0m01:03:17.848866 [debug] [Thread-3 (]: Began running node model.salesAnalysis.order_segments_2023
[0m01:03:17.849696 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_with_prods
[0m01:03:17.849389 [info ] [Thread-1 (]: 1 of 6 START sql view model sales_analysis.avg_prods_per_order_2023 ............ [RUN]
[0m01:03:17.850233 [info ] [Thread-2 (]: 2 of 6 START sql view model sales_analysis.monthly_orders_2023 ................. [RUN]
[0m01:03:17.850676 [info ] [Thread-3 (]: 3 of 6 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m01:03:17.851251 [info ] [Thread-4 (]: 4 of 6 START sql view model sales_analysis.orders_with_prods ................... [RUN]
[0m01:03:17.851732 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_prods_per_order_2023)
[0m01:03:17.852094 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.monthly_orders_2023'
[0m01:03:17.852409 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m01:03:17.852683 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_with_prods'
[0m01:03:17.852925 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_prods_per_order_2023
[0m01:03:17.853144 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.monthly_orders_2023
[0m01:03:17.853352 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m01:03:17.853553 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_with_prods
[0m01:03:17.859858 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_prods_per_order_2023"
[0m01:03:17.862405 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.monthly_orders_2023"
[0m01:03:17.864867 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m01:03:17.867693 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_prods"
[0m01:03:17.869314 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_prods_per_order_2023
[0m01:03:17.892422 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_prods_per_order_2023"
[0m01:03:17.892807 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.monthly_orders_2023
[0m01:03:17.893106 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m01:03:17.893463 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_with_prods
[0m01:03:17.895453 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.monthly_orders_2023"
[0m01:03:17.897224 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m01:03:17.897517 [debug] [Thread-1 (]: On model.salesAnalysis.avg_prods_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_prods_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_prods_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m01:03:17.899236 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_prods"
[0m01:03:17.899684 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:03:17.900467 [debug] [Thread-2 (]: On model.salesAnalysis.monthly_orders_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.monthly_orders_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`monthly_orders_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m01:03:17.900747 [debug] [Thread-3 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.customers_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.customers_id = prev_orders.customers_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.customers_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m01:03:17.901322 [debug] [Thread-4 (]: On model.salesAnalysis.orders_with_prods: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_prods"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m01:03:17.901764 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:03:17.902298 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:03:17.902514 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:03:18.662623 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2c9f0d6f-158d-42da-b44c-153ac8094729&page=queryresults
[0m01:03:18.664279 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:2fa9af68-1ec7-4dfe-a97a-53c5d069ac6e&page=queryresults
[0m01:03:18.665368 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:a6b752b8-d4d2-401f-9e71-1190ab41fe0a&page=queryresults
[0m01:03:18.667284 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:e3d29bba-ecb3-4a99-bfee-87077ca00b4c&page=queryresults
[0m01:03:19.104897 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x172770490>]}
[0m01:03:19.105135 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ea1f1d0>]}
[0m01:03:19.105362 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x172770590>]}
[0m01:03:19.105816 [info ] [Thread-2 (]: 2 of 6 OK created sql view model sales_analysis.monthly_orders_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m01:03:19.106187 [info ] [Thread-4 (]: 4 of 6 OK created sql view model sales_analysis.orders_with_prods .............. [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m01:03:19.106602 [info ] [Thread-3 (]: 3 of 6 OK created sql view model sales_analysis.order_segments_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.25s]
[0m01:03:19.106964 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.monthly_orders_2023
[0m01:03:19.107244 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_with_prods
[0m01:03:19.107497 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m01:03:19.107715 [debug] [Thread-2 (]: Began running node model.salesAnalysis.total_orders_2023
[0m01:03:19.108202 [info ] [Thread-2 (]: 5 of 6 START sql view model sales_analysis.total_orders_2023 ................... [RUN]
[0m01:03:19.108408 [debug] [Thread-4 (]: Began running node model.salesAnalysis.2023_orders_with_segments
[0m01:03:19.108637 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.monthly_orders_2023, now model.salesAnalysis.total_orders_2023)
[0m01:03:19.108892 [info ] [Thread-4 (]: 6 of 6 START sql view model sales_analysis.2023_orders_with_segments ........... [RUN]
[0m01:03:19.109103 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.total_orders_2023
[0m01:03:19.109320 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.orders_with_prods, now model.salesAnalysis.2023_orders_with_segments)
[0m01:03:19.111244 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.total_orders_2023"
[0m01:03:19.111503 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.2023_orders_with_segments
[0m01:03:19.113845 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.2023_orders_with_segments"
[0m01:03:19.114347 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.total_orders_2023
[0m01:03:19.116161 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.total_orders_2023"
[0m01:03:19.116549 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.2023_orders_with_segments
[0m01:03:19.118278 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.2023_orders_with_segments"
[0m01:03:19.118590 [debug] [Thread-2 (]: On model.salesAnalysis.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.total_orders_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`total_orders_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m01:03:19.118917 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:03:19.119176 [debug] [Thread-4 (]: On model.salesAnalysis.2023_orders_with_segments: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.2023_orders_with_segments"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`2023_orders_with_segments`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        o.orders_id,
        o.date_date,
        o.customers_id,
        COUNT(DISTINCT s.products_id) as qty_products
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date, o.customers_id
)

SELECT 
    o.orders_id,
    o.date_date,
    o.qty_products,
    seg.segment
FROM orders_2023 o
LEFT JOIN `salesanalysis-450811`.`sales_analysis`.`order_segments_2023` seg
    ON o.orders_id = seg.orders_id
ORDER BY o.date_date, o.orders_id;


[0m01:03:19.120100 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:03:19.267077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1726d0690>]}
[0m01:03:19.267674 [info ] [Thread-1 (]: 1 of 6 OK created sql view model sales_analysis.avg_prods_per_order_2023 ....... [[32mCREATE VIEW (0 processed)[0m in 1.42s]
[0m01:03:19.268106 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_prods_per_order_2023
[0m01:03:19.886401 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:87b520ec-46cb-461a-9ca8-190bfb4a0d80&page=queryresults
[0m01:03:19.984292 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:1e1b08e5-e651-40a1-833b-bb953009bc1d&page=queryresults
[0m01:03:20.313746 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e95550>]}
[0m01:03:20.314968 [info ] [Thread-2 (]: 5 of 6 OK created sql view model sales_analysis.total_orders_2023 .............. [[32mCREATE VIEW (0 processed)[0m in 1.20s]
[0m01:03:20.315850 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.total_orders_2023
[0m01:03:20.386446 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3f6c6c28-5044-49bc-872d-902148a3a305', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ed8e450>]}
[0m01:03:20.387311 [info ] [Thread-4 (]: 6 of 6 OK created sql view model sales_analysis.2023_orders_with_segments ...... [[32mCREATE VIEW (0 processed)[0m in 1.28s]
[0m01:03:20.387872 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.2023_orders_with_segments
[0m01:03:20.389778 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:03:20.390394 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:03:20.390691 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_prods_per_order_2023' was properly closed.
[0m01:03:20.390957 [debug] [MainThread]: Connection 'model.salesAnalysis.total_orders_2023' was properly closed.
[0m01:03:20.391198 [debug] [MainThread]: Connection 'model.salesAnalysis.order_segments_2023' was properly closed.
[0m01:03:20.391438 [debug] [MainThread]: Connection 'model.salesAnalysis.2023_orders_with_segments' was properly closed.
[0m01:03:20.391798 [info ] [MainThread]: 
[0m01:03:20.392109 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.37 seconds (4.37s).
[0m01:03:20.393261 [debug] [MainThread]: Command end result
[0m01:03:20.416248 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:03:20.417897 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:03:20.422333 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m01:03:20.422589 [info ] [MainThread]: 
[0m01:03:20.422846 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:03:20.423025 [info ] [MainThread]: 
[0m01:03:20.423221 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m01:03:20.423570 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.2312665, "process_in_blocks": "0", "process_kernel_time": 2.386081, "process_mem_max_rss": "249659392", "process_out_blocks": "0", "process_user_time": 2.634991}
[0m01:03:20.423921 [debug] [MainThread]: Command `dbt run` succeeded at 01:03:20.423867 after 6.23 seconds
[0m01:03:20.424186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104668cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1045f4d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104737c10>]}
[0m01:03:20.424421 [debug] [MainThread]: Flushing usage events
[0m01:03:21.708686 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:04:42.498741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12207f210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122103090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122103a50>]}


============================== 01:04:42.503052 | 20660f2f-96c7-46e9-8819-abfd074a1007 ==============================
[0m01:04:42.503052 [info ] [MainThread]: Running with dbt=1.9.2
[0m01:04:42.503513 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'profiles_dir': '/Users/edou/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'None', 'quiet': 'False', 'no_print': 'None', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt test', 'send_anonymous_usage_stats': 'True'}
[0m01:04:43.633483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20660f2f-96c7-46e9-8819-abfd074a1007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x124d2ac90>]}
[0m01:04:43.668043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20660f2f-96c7-46e9-8819-abfd074a1007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107230050>]}
[0m01:04:43.668526 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:04:43.763240 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m01:04:43.834264 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m01:04:43.834572 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m01:04:43.838176 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m01:04:43.857583 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20660f2f-96c7-46e9-8819-abfd074a1007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bc921d0>]}
[0m01:04:43.902013 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:04:43.906320 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:04:43.926835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20660f2f-96c7-46e9-8819-abfd074a1007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ee0fed0>]}
[0m01:04:43.927198 [info ] [MainThread]: Found 6 models, 10 data tests, 2 sources, 491 macros
[0m01:04:43.927390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20660f2f-96c7-46e9-8819-abfd074a1007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bcda310>]}
[0m01:04:43.928531 [info ] [MainThread]: 
[0m01:04:43.928749 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:04:43.928887 [info ] [MainThread]: 
[0m01:04:43.929173 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:04:43.931195 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811_sales_analysis'
[0m01:04:43.931383 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:04:45.212639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20660f2f-96c7-46e9-8819-abfd074a1007', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16bb3e1d0>]}
[0m01:04:45.213555 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:04:45.216166 [debug] [Thread-1 (]: Began running node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:04:45.216779 [debug] [Thread-2 (]: Began running node test.salesAnalysis.greater_than_or_equal_to_orders_with_prods_qty_product__0.071432cc75
[0m01:04:45.217174 [debug] [Thread-3 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:04:45.217503 [debug] [Thread-4 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:04:45.217950 [info ] [Thread-1 (]: 1 of 10 START test accepted_values_order_segments_2023_segment__New__Returning__VIP  [RUN]
[0m01:04:45.218461 [info ] [Thread-2 (]: 2 of 10 START test greater_than_or_equal_to_orders_with_prods_qty_product__0 ... [RUN]
[0m01:04:45.218968 [info ] [Thread-3 (]: 3 of 10 START test not_null_order_segments_2023_date_date ...................... [RUN]
[0m01:04:45.219629 [info ] [Thread-4 (]: 4 of 10 START test not_null_order_segments_2023_orders_id ...................... [RUN]
[0m01:04:45.220259 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f)
[0m01:04:45.220820 [debug] [Thread-2 (]: Acquiring new bigquery connection 'test.salesAnalysis.greater_than_or_equal_to_orders_with_prods_qty_product__0.071432cc75'
[0m01:04:45.221293 [debug] [Thread-3 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c'
[0m01:04:45.221690 [debug] [Thread-4 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67'
[0m01:04:45.222037 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:04:45.222381 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.greater_than_or_equal_to_orders_with_prods_qty_product__0.071432cc75
[0m01:04:45.222721 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:04:45.223065 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:04:45.241212 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"
[0m01:04:45.250863 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:04:45.250268 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"
[0m01:04:45.254356 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"
[0m01:04:45.255641 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:04:45.256009 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:04:45.267483 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"
[0m01:04:45.267819 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:04:45.270403 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"
[0m01:04:45.332465 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"
[0m01:04:45.333030 [debug] [Thread-1 (]: On test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        segment as value_field,
        count(*) as n_records

    from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
    group by segment

)

select *
from all_values
where value_field not in (
    'New','Returning','VIP'
)



      
    ) dbt_internal_test
[0m01:04:45.333292 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:04:45.334379 [debug] [Thread-3 (]: On test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_date
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where date_date is null



      
    ) dbt_internal_test
[0m01:04:45.334626 [debug] [Thread-4 (]: On test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select orders_id
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where orders_id is null



      
    ) dbt_internal_test
[0m01:04:45.334832 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:04:45.335385 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:04:45.339379 [debug] [Thread-2 (]: Compilation Error in test greater_than_or_equal_to_orders_with_prods_qty_product__0 (models/orders_with_prods.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m01:04:45.339815 [error] [Thread-2 (]: 2 of 10 ERROR greater_than_or_equal_to_orders_with_prods_qty_product__0 ........ [[31mERROR[0m in 0.12s]
[0m01:04:45.340122 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.greater_than_or_equal_to_orders_with_prods_qty_product__0.071432cc75
[0m01:04:45.340317 [debug] [Thread-2 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:04:45.340554 [debug] [Thread-7 (]: Marking all children of 'test.salesAnalysis.greater_than_or_equal_to_orders_with_prods_qty_product__0.071432cc75' to be skipped because of status 'error'.  Reason: Compilation Error in test greater_than_or_equal_to_orders_with_prods_qty_product__0 (models/orders_with_prods.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps"..
[0m01:04:45.340752 [info ] [Thread-2 (]: 5 of 10 START test not_null_order_segments_2023_segment ........................ [RUN]
[0m01:04:45.341136 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.greater_than_or_equal_to_orders_with_prods_qty_product__0.071432cc75, now test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32)
[0m01:04:45.341351 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:04:45.344035 [debug] [Thread-2 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"
[0m01:04:45.344568 [debug] [Thread-2 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:04:45.345896 [debug] [Thread-2 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"
[0m01:04:45.346320 [debug] [Thread-2 (]: On test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select segment
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where segment is null



      
    ) dbt_internal_test
[0m01:04:45.346533 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:04:46.415019 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:3d0f66b7-0e25-4ddc-9559-ebec2a5b5e91&page=queryresults
[0m01:04:46.454995 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:b80e6664-90da-4b72-8594-72968189a3fe&page=queryresults
[0m01:04:46.560120 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:82e64a27-82aa-43d9-b2db-bcc0b2d5fc39&page=queryresults
[0m01:04:46.599450 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:48e90bd6-cb14-400b-9707-d42a77fd2c57&page=queryresults
[0m01:04:47.087685 [info ] [Thread-4 (]: 4 of 10 PASS not_null_order_segments_2023_orders_id ............................ [[32mPASS[0m in 1.87s]
[0m01:04:47.088713 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:04:47.089212 [debug] [Thread-4 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:04:47.089766 [info ] [Thread-4 (]: 6 of 10 START test not_null_orders_with_prods_date_date ........................ [RUN]
[0m01:04:47.090671 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67, now test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4)
[0m01:04:47.091158 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:04:47.096061 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"
[0m01:04:47.096894 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:04:47.099278 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"
[0m01:04:47.100092 [debug] [Thread-4 (]: On test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_date
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where date_date is null



      
    ) dbt_internal_test
[0m01:04:47.100641 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:04:47.120486 [info ] [Thread-3 (]: 3 of 10 PASS not_null_order_segments_2023_date_date ............................ [[32mPASS[0m in 1.90s]
[0m01:04:47.121082 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:04:47.121381 [debug] [Thread-3 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:04:47.121775 [info ] [Thread-3 (]: 7 of 10 START test not_null_orders_with_prods_orders_id ........................ [RUN]
[0m01:04:47.122268 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c, now test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109)
[0m01:04:47.122557 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:04:47.127358 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"
[0m01:04:47.128014 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:04:47.129739 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"
[0m01:04:47.130403 [debug] [Thread-3 (]: On test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select orders_id
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where orders_id is null



      
    ) dbt_internal_test
[0m01:04:47.130694 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:04:47.151685 [info ] [Thread-1 (]: 1 of 10 PASS accepted_values_order_segments_2023_segment__New__Returning__VIP .. [[32mPASS[0m in 1.93s]
[0m01:04:47.152134 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:04:47.152383 [debug] [Thread-1 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:04:47.152737 [info ] [Thread-1 (]: 8 of 10 START test not_null_orders_with_prods_qty_product ...................... [RUN]
[0m01:04:47.153212 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f, now test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a)
[0m01:04:47.153457 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:04:47.156352 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"
[0m01:04:47.157311 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:04:47.159004 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"
[0m01:04:47.159474 [debug] [Thread-1 (]: On test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select qty_product
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where qty_product is null



      
    ) dbt_internal_test
[0m01:04:47.159713 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:04:47.214844 [info ] [Thread-2 (]: 5 of 10 PASS not_null_order_segments_2023_segment .............................. [[32mPASS[0m in 1.87s]
[0m01:04:47.215451 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:04:47.215753 [debug] [Thread-2 (]: Began running node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:04:47.216061 [info ] [Thread-2 (]: 9 of 10 START test unique_order_segments_2023_orders_id ........................ [RUN]
[0m01:04:47.216380 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32, now test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081)
[0m01:04:47.216628 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:04:47.220715 [debug] [Thread-2 (]: Writing injected SQL for node "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"
[0m01:04:47.221256 [debug] [Thread-2 (]: Began executing node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:04:47.222903 [debug] [Thread-2 (]: Writing runtime sql for node "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"
[0m01:04:47.224159 [debug] [Thread-2 (]: On test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select orders_id as unique_field
  from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  where orders_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m01:04:47.224518 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:04:48.462016 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:d146c754-e514-406c-866d-fbb07bc54b5f&page=queryresults
[0m01:04:48.462885 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:725e8e9e-41a2-41a9-b782-3ee667a2e75f&page=queryresults
[0m01:04:48.463423 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:baa6730d-56bf-4552-90fc-00e473479b72&page=queryresults
[0m01:04:48.464218 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:1c63c864-83b9-459f-b4c0-72e8f1011528&page=queryresults
[0m01:04:49.042561 [info ] [Thread-1 (]: 8 of 10 PASS not_null_orders_with_prods_qty_product ............................ [[32mPASS[0m in 1.89s]
[0m01:04:49.045806 [info ] [Thread-2 (]: 9 of 10 PASS unique_order_segments_2023_orders_id .............................. [[32mPASS[0m in 1.83s]
[0m01:04:49.046417 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:04:49.046954 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:04:49.047509 [debug] [Thread-1 (]: Began running node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:04:49.048258 [info ] [Thread-1 (]: 10 of 10 START test unique_orders_with_prods_orders_id ......................... [RUN]
[0m01:04:49.048856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a, now test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d)
[0m01:04:49.049498 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:04:49.054127 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"
[0m01:04:49.055002 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:04:49.057282 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"
[0m01:04:49.058349 [debug] [Thread-1 (]: On test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select orders_id as unique_field
  from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
  where orders_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m01:04:49.058868 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:04:49.063840 [info ] [Thread-3 (]: 7 of 10 PASS not_null_orders_with_prods_orders_id .............................. [[32mPASS[0m in 1.94s]
[0m01:04:49.064428 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:04:49.073361 [info ] [Thread-4 (]: 6 of 10 PASS not_null_orders_with_prods_date_date .............................. [[32mPASS[0m in 1.98s]
[0m01:04:49.073923 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:04:50.089287 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:442e4405-a996-4027-a24d-c98891ad3162&page=queryresults
[0m01:04:50.641180 [info ] [Thread-1 (]: 10 of 10 PASS unique_orders_with_prods_orders_id ............................... [[32mPASS[0m in 1.59s]
[0m01:04:50.642294 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:04:50.644191 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:04:50.645008 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:04:50.645345 [debug] [MainThread]: Connection 'test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d' was properly closed.
[0m01:04:50.645651 [debug] [MainThread]: Connection 'test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081' was properly closed.
[0m01:04:50.645944 [debug] [MainThread]: Connection 'test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109' was properly closed.
[0m01:04:50.646231 [debug] [MainThread]: Connection 'test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4' was properly closed.
[0m01:04:50.646627 [info ] [MainThread]: 
[0m01:04:50.647009 [info ] [MainThread]: Finished running 10 data tests in 0 hours 0 minutes and 6.72 seconds (6.72s).
[0m01:04:50.649179 [debug] [MainThread]: Command end result
[0m01:04:50.675014 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:04:50.676295 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:04:50.681292 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m01:04:50.681548 [info ] [MainThread]: 
[0m01:04:50.681789 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m01:04:50.681993 [info ] [MainThread]: 
[0m01:04:50.682244 [error] [MainThread]:   Compilation Error in test greater_than_or_equal_to_orders_with_prods_qty_product__0 (models/orders_with_prods.yml)
  'test_greater_than_or_equal_to' is undefined. This can happen when calling a macro that does not exist. Check for typos and/or install package dependencies with "dbt deps".
[0m01:04:50.682454 [info ] [MainThread]: 
[0m01:04:50.682656 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=1 SKIP=0 TOTAL=10
[0m01:04:50.682963 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": false, "command_wall_clock_time": 8.227198, "process_in_blocks": "0", "process_kernel_time": 2.330758, "process_mem_max_rss": "247857152", "process_out_blocks": "0", "process_user_time": 2.545794}
[0m01:04:50.683265 [debug] [MainThread]: Command `dbt test` failed at 01:04:50.683221 after 8.23 seconds
[0m01:04:50.683517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12207f490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10460d790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16ddf1910>]}
[0m01:04:50.683751 [debug] [MainThread]: Flushing usage events
[0m01:04:51.898326 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m01:06:37.869108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a82f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b03fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b03ed0>]}


============================== 01:06:37.873295 | 0badd238-8ddb-4d74-b6da-36937d32fd2c ==============================
[0m01:06:37.873295 [info ] [MainThread]: Running with dbt=1.9.2
[0m01:06:37.873681 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/edou/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt test', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m01:06:39.291690 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0badd238-8ddb-4d74-b6da-36937d32fd2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1584efe90>]}
[0m01:06:39.324819 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0badd238-8ddb-4d74-b6da-36937d32fd2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10533b4d0>]}
[0m01:06:39.325278 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m01:06:39.417309 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m01:06:39.485622 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m01:06:39.486115 [debug] [MainThread]: Partial parsing: updated file: salesAnalysis://models/orders_with_prods.yml
[0m01:06:39.771786 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m01:06:39.778155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0badd238-8ddb-4d74-b6da-36937d32fd2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x148b44bd0>]}
[0m01:06:39.825446 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:06:39.829846 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:06:39.851849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0badd238-8ddb-4d74-b6da-36937d32fd2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x159c5eb10>]}
[0m01:06:39.852206 [info ] [MainThread]: Found 6 models, 9 data tests, 2 sources, 491 macros
[0m01:06:39.852381 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0badd238-8ddb-4d74-b6da-36937d32fd2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158bfd1d0>]}
[0m01:06:39.853516 [info ] [MainThread]: 
[0m01:06:39.853715 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m01:06:39.853881 [info ] [MainThread]: 
[0m01:06:39.854245 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m01:06:39.856351 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811_sales_analysis'
[0m01:06:39.856620 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m01:06:41.168976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0badd238-8ddb-4d74-b6da-36937d32fd2c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x158b11c10>]}
[0m01:06:41.169664 [debug] [MainThread]: Opening a new connection, currently in state init
[0m01:06:41.171225 [debug] [Thread-1 (]: Began running node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:06:41.171627 [debug] [Thread-2 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:06:41.171942 [debug] [Thread-3 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:06:41.172170 [debug] [Thread-4 (]: Began running node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:06:41.172484 [info ] [Thread-1 (]: 1 of 9 START test accepted_values_order_segments_2023_segment__New__Returning__VIP  [RUN]
[0m01:06:41.173016 [info ] [Thread-2 (]: 2 of 9 START test not_null_order_segments_2023_date_date ....................... [RUN]
[0m01:06:41.173373 [info ] [Thread-3 (]: 3 of 9 START test not_null_order_segments_2023_orders_id ....................... [RUN]
[0m01:06:41.173616 [info ] [Thread-4 (]: 4 of 9 START test not_null_order_segments_2023_segment ......................... [RUN]
[0m01:06:41.173950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f)
[0m01:06:41.174253 [debug] [Thread-2 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c'
[0m01:06:41.174585 [debug] [Thread-3 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67'
[0m01:06:41.174837 [debug] [Thread-4 (]: Acquiring new bigquery connection 'test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32'
[0m01:06:41.175249 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:06:41.175587 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:06:41.175805 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:06:41.175976 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:06:41.190723 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"
[0m01:06:41.195446 [debug] [Thread-2 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"
[0m01:06:41.197816 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"
[0m01:06:41.200415 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"
[0m01:06:41.201584 [debug] [Thread-2 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:06:41.201895 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:06:41.202152 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:06:41.202447 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:06:41.212759 [debug] [Thread-2 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"
[0m01:06:41.214280 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"
[0m01:06:41.215513 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"
[0m01:06:41.217151 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"
[0m01:06:41.217854 [debug] [Thread-2 (]: On test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_date
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where date_date is null



      
    ) dbt_internal_test
[0m01:06:41.218117 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m01:06:41.218896 [debug] [Thread-4 (]: On test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select segment
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where segment is null



      
    ) dbt_internal_test
[0m01:06:41.219190 [debug] [Thread-1 (]: On test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with all_values as (

    select
        segment as value_field,
        count(*) as n_records

    from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
    group by segment

)

select *
from all_values
where value_field not in (
    'New','Returning','VIP'
)



      
    ) dbt_internal_test
[0m01:06:41.219465 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m01:06:41.219818 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:06:41.220031 [debug] [Thread-3 (]: On test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select orders_id
from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
where orders_id is null



      
    ) dbt_internal_test
[0m01:06:41.221604 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m01:06:42.032257 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:a624a50d-271a-4cda-87fa-e656844b196d&page=queryresults
[0m01:06:42.090958 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:c120b90d-6ccb-4728-974c-5f0ca669689d&page=queryresults
[0m01:06:42.103771 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:99f2e2a1-6549-4407-9bf8-6b5c0c14d30f&page=queryresults
[0m01:06:42.221710 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:5c5e2641-6ec1-4222-a87c-fa9a69c8b7cf&page=queryresults
[0m01:06:42.845015 [info ] [Thread-3 (]: 3 of 9 PASS not_null_order_segments_2023_orders_id ............................. [[32mPASS[0m in 1.67s]
[0m01:06:42.848127 [info ] [Thread-4 (]: 4 of 9 PASS not_null_order_segments_2023_segment ............................... [[32mPASS[0m in 1.67s]
[0m01:06:42.851356 [info ] [Thread-2 (]: 2 of 9 PASS not_null_order_segments_2023_date_date ............................. [[32mPASS[0m in 1.68s]
[0m01:06:42.852018 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67
[0m01:06:42.852754 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32
[0m01:06:42.853349 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c
[0m01:06:42.853727 [debug] [Thread-3 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:06:42.854256 [debug] [Thread-4 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:06:42.854758 [debug] [Thread-2 (]: Began running node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:06:42.855179 [info ] [Thread-3 (]: 5 of 9 START test not_null_orders_with_prods_date_date ......................... [RUN]
[0m01:06:42.855645 [info ] [Thread-4 (]: 6 of 9 START test not_null_orders_with_prods_orders_id ......................... [RUN]
[0m01:06:42.856091 [info ] [Thread-2 (]: 7 of 9 START test not_null_orders_with_prods_qty_product ....................... [RUN]
[0m01:06:42.856597 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_orders_id.a49ce66f67, now test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4)
[0m01:06:42.856941 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_segment.8f8a087b32, now test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109)
[0m01:06:42.857250 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_order_segments_2023_date_date.dd8595e06c, now test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a)
[0m01:06:42.857550 [debug] [Thread-3 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:06:42.857825 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:06:42.858091 [debug] [Thread-2 (]: Began compiling node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:06:42.862226 [debug] [Thread-3 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"
[0m01:06:42.866753 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"
[0m01:06:42.869837 [debug] [Thread-2 (]: Writing injected SQL for node "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"
[0m01:06:42.871042 [debug] [Thread-3 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:06:42.871375 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:06:42.871633 [debug] [Thread-2 (]: Began executing node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:06:42.873642 [debug] [Thread-3 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"
[0m01:06:42.875481 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"
[0m01:06:42.877402 [debug] [Thread-2 (]: Writing runtime sql for node "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"
[0m01:06:42.878141 [debug] [Thread-3 (]: On test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select date_date
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where date_date is null



      
    ) dbt_internal_test
[0m01:06:42.878574 [debug] [Thread-4 (]: On test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select orders_id
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where orders_id is null



      
    ) dbt_internal_test
[0m01:06:42.878884 [debug] [Thread-2 (]: On test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    



select qty_product
from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
where qty_product is null



      
    ) dbt_internal_test
[0m01:06:42.879181 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m01:06:42.879433 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:06:42.879694 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m01:06:42.898274 [info ] [Thread-1 (]: 1 of 9 PASS accepted_values_order_segments_2023_segment__New__Returning__VIP ... [[32mPASS[0m in 1.72s]
[0m01:06:42.898980 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f
[0m01:06:42.899348 [debug] [Thread-1 (]: Began running node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:06:42.899641 [info ] [Thread-1 (]: 8 of 9 START test unique_order_segments_2023_orders_id ......................... [RUN]
[0m01:06:42.899965 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.accepted_values_order_segments_2023_segment__New__Returning__VIP.400f4ee84f, now test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081)
[0m01:06:42.900200 [debug] [Thread-1 (]: Began compiling node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:06:42.904229 [debug] [Thread-1 (]: Writing injected SQL for node "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"
[0m01:06:42.904716 [debug] [Thread-1 (]: Began executing node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:06:42.906289 [debug] [Thread-1 (]: Writing runtime sql for node "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"
[0m01:06:42.907194 [debug] [Thread-1 (]: On test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select orders_id as unique_field
  from `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  where orders_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m01:06:42.907469 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m01:06:43.864559 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f9e9ae27-6e7a-4a56-b1b2-8863b27055ff&page=queryresults
[0m01:06:43.896758 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:9ddc89e3-7491-4b81-9782-ac3a1206b6ba&page=queryresults
[0m01:06:43.898121 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f32bea3b-f122-4d3e-824f-a52d21da2633&page=queryresults
[0m01:06:43.909088 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:f047aee8-96d9-4ee8-8264-5f5c0438bdd8&page=queryresults
[0m01:06:44.472604 [info ] [Thread-4 (]: 6 of 9 PASS not_null_orders_with_prods_orders_id ............................... [[32mPASS[0m in 1.62s]
[0m01:06:44.475008 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109
[0m01:06:44.477522 [info ] [Thread-3 (]: 5 of 9 PASS not_null_orders_with_prods_date_date ............................... [[32mPASS[0m in 1.62s]
[0m01:06:44.478146 [debug] [Thread-4 (]: Began running node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:06:44.479772 [debug] [Thread-3 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4
[0m01:06:44.480311 [info ] [Thread-4 (]: 9 of 9 START test unique_orders_with_prods_orders_id ........................... [RUN]
[0m01:06:44.483251 [info ] [Thread-1 (]: 8 of 9 PASS unique_order_segments_2023_orders_id ............................... [[32mPASS[0m in 1.58s]
[0m01:06:44.483983 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.salesAnalysis.not_null_orders_with_prods_orders_id.35621ae109, now test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d)
[0m01:06:44.484518 [debug] [Thread-1 (]: Finished running node test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081
[0m01:06:44.484869 [debug] [Thread-4 (]: Began compiling node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:06:44.490374 [debug] [Thread-4 (]: Writing injected SQL for node "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"
[0m01:06:44.491688 [debug] [Thread-4 (]: Began executing node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:06:44.494236 [debug] [Thread-4 (]: Writing runtime sql for node "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"
[0m01:06:44.497345 [info ] [Thread-2 (]: 7 of 9 PASS not_null_orders_with_prods_qty_product ............................. [[32mPASS[0m in 1.64s]
[0m01:06:44.498391 [debug] [Thread-2 (]: Finished running node test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a
[0m01:06:44.499002 [debug] [Thread-4 (]: On test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d"} */
select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
    

with dbt_test__target as (

  select orders_id as unique_field
  from `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
  where orders_id is not null

)

select
    unique_field,
    count(*) as n_records

from dbt_test__target
group by unique_field
having count(*) > 1



      
    ) dbt_internal_test
[0m01:06:44.499356 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m01:06:45.442119 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:df342902-39bd-4e98-98ba-72d19429368a&page=queryresults
[0m01:06:46.011762 [info ] [Thread-4 (]: 9 of 9 PASS unique_orders_with_prods_orders_id ................................. [[32mPASS[0m in 1.53s]
[0m01:06:46.012954 [debug] [Thread-4 (]: Finished running node test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d
[0m01:06:46.013974 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m01:06:46.014386 [debug] [MainThread]: Connection 'master' was properly closed.
[0m01:06:46.014562 [debug] [MainThread]: Connection 'test.salesAnalysis.unique_order_segments_2023_orders_id.a51dbd3081' was properly closed.
[0m01:06:46.014722 [debug] [MainThread]: Connection 'test.salesAnalysis.not_null_orders_with_prods_qty_product.08285bf43a' was properly closed.
[0m01:06:46.014962 [debug] [MainThread]: Connection 'test.salesAnalysis.not_null_orders_with_prods_date_date.e1604497e4' was properly closed.
[0m01:06:46.015137 [debug] [MainThread]: Connection 'test.salesAnalysis.unique_orders_with_prods_orders_id.fac05f286d' was properly closed.
[0m01:06:46.015355 [info ] [MainThread]: 
[0m01:06:46.015551 [info ] [MainThread]: Finished running 9 data tests in 0 hours 0 minutes and 6.16 seconds (6.16s).
[0m01:06:46.016574 [debug] [MainThread]: Command end result
[0m01:06:46.033717 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m01:06:46.035374 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m01:06:46.040225 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m01:06:46.040484 [info ] [MainThread]: 
[0m01:06:46.040691 [info ] [MainThread]: [32mCompleted successfully[0m
[0m01:06:46.040843 [info ] [MainThread]: 
[0m01:06:46.041082 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m01:06:46.041399 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 8.215907, "process_in_blocks": "0", "process_kernel_time": 1.520019, "process_mem_max_rss": "245596160", "process_out_blocks": "0", "process_user_time": 3.374583}
[0m01:06:46.041692 [debug] [MainThread]: Command `dbt test` succeeded at 01:06:46.041649 after 8.22 seconds
[0m01:06:46.041926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107af5210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107af6d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10314fb90>]}
[0m01:06:46.042138 [debug] [MainThread]: Flushing usage events
[0m01:06:47.247166 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m18:11:03.476422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108f83310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108abf590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109007f90>]}


============================== 18:11:03.480948 | f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8 ==============================
[0m18:11:03.480948 [info ] [MainThread]: Running with dbt=1.9.2
[0m18:11:03.481337 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/logs', 'version_check': 'True', 'profiles_dir': '/Users/edou/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'empty': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:11:07.512479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c6d2710>]}
[0m18:11:07.547249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106933910>]}
[0m18:11:07.547742 [info ] [MainThread]: Registered adapter: bigquery=1.9.1
[0m18:11:07.642077 [debug] [MainThread]: checksum: 12b12750b70de726cfd89136b8e24afc3f3e77597a97bff40ab7e5f9b39d5e18, vars: {}, profile: , target: , version: 1.9.2
[0m18:11:07.711867 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:11:07.712165 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:11:07.715475 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.salesAnalysis.example
[0m18:11:07.735182 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e0585d0>]}
[0m18:11:07.779648 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m18:11:07.784047 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m18:11:07.797811 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e1c2b90>]}
[0m18:11:07.798175 [info ] [MainThread]: Found 6 models, 9 data tests, 2 sources, 491 macros
[0m18:11:07.798363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16df08a10>]}
[0m18:11:07.799391 [info ] [MainThread]: 
[0m18:11:07.799602 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m18:11:07.799737 [info ] [MainThread]: 
[0m18:11:07.800026 [debug] [MainThread]: Acquiring new bigquery connection 'master'
[0m18:11:07.802302 [debug] [ThreadPool]: Acquiring new bigquery connection 'list_salesanalysis-450811'
[0m18:11:07.802595 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:11:10.858964 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_salesanalysis-450811, now list_salesanalysis-450811_sales_analysis)
[0m18:11:10.860162 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:11:11.373912 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e1d22d0>]}
[0m18:11:11.374812 [debug] [MainThread]: Opening a new connection, currently in state init
[0m18:11:11.377151 [debug] [Thread-1 (]: Began running node model.salesAnalysis.avg_prods_per_order_2023
[0m18:11:11.377651 [debug] [Thread-2 (]: Began running node model.salesAnalysis.monthly_orders_2023
[0m18:11:11.378430 [debug] [Thread-3 (]: Began running node model.salesAnalysis.order_segments_2023
[0m18:11:11.378148 [info ] [Thread-1 (]: 1 of 6 START sql view model sales_analysis.avg_prods_per_order_2023 ............ [RUN]
[0m18:11:11.378843 [debug] [Thread-4 (]: Began running node model.salesAnalysis.orders_with_prods
[0m18:11:11.379265 [info ] [Thread-2 (]: 2 of 6 START sql view model sales_analysis.monthly_orders_2023 ................. [RUN]
[0m18:11:11.379672 [info ] [Thread-3 (]: 3 of 6 START sql view model sales_analysis.order_segments_2023 ................. [RUN]
[0m18:11:11.380127 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_salesanalysis-450811_sales_analysis, now model.salesAnalysis.avg_prods_per_order_2023)
[0m18:11:11.380504 [info ] [Thread-4 (]: 4 of 6 START sql view model sales_analysis.orders_with_prods ................... [RUN]
[0m18:11:11.380893 [debug] [Thread-2 (]: Acquiring new bigquery connection 'model.salesAnalysis.monthly_orders_2023'
[0m18:11:11.381272 [debug] [Thread-3 (]: Acquiring new bigquery connection 'model.salesAnalysis.order_segments_2023'
[0m18:11:11.381594 [debug] [Thread-1 (]: Began compiling node model.salesAnalysis.avg_prods_per_order_2023
[0m18:11:11.381946 [debug] [Thread-4 (]: Acquiring new bigquery connection 'model.salesAnalysis.orders_with_prods'
[0m18:11:11.382225 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.monthly_orders_2023
[0m18:11:11.382580 [debug] [Thread-3 (]: Began compiling node model.salesAnalysis.order_segments_2023
[0m18:11:11.394194 [debug] [Thread-1 (]: Writing injected SQL for node "model.salesAnalysis.avg_prods_per_order_2023"
[0m18:11:11.394619 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.orders_with_prods
[0m18:11:11.397324 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.monthly_orders_2023"
[0m18:11:11.399861 [debug] [Thread-3 (]: Writing injected SQL for node "model.salesAnalysis.order_segments_2023"
[0m18:11:11.402512 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.orders_with_prods"
[0m18:11:11.403095 [debug] [Thread-1 (]: Began executing node model.salesAnalysis.avg_prods_per_order_2023
[0m18:11:11.416133 [debug] [Thread-3 (]: Began executing node model.salesAnalysis.order_segments_2023
[0m18:11:11.427055 [debug] [Thread-3 (]: Writing runtime sql for node "model.salesAnalysis.order_segments_2023"
[0m18:11:11.427859 [debug] [Thread-1 (]: Writing runtime sql for node "model.salesAnalysis.avg_prods_per_order_2023"
[0m18:11:11.428074 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.orders_with_prods
[0m18:11:11.428294 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.monthly_orders_2023
[0m18:11:11.430266 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.orders_with_prods"
[0m18:11:11.432290 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.monthly_orders_2023"
[0m18:11:11.432781 [debug] [Thread-3 (]: On model.salesAnalysis.order_segments_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.order_segments_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`order_segments_2023`
  OPTIONS()
  as WITH customer_order_counts AS (
    -- Count previous orders for each customer in the 12 months before each 2023 order
    SELECT 
        o2023.orders_id,
        o2023.date_date,
        o2023.customers_id,
        COUNT(DISTINCT prev_orders.orders_id) as previous_orders_12m
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o2023
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`orders` prev_orders
        ON o2023.customers_id = prev_orders.customers_id
        AND prev_orders.date_date BETWEEN 
            DATE_SUB(o2023.date_date, INTERVAL 12 MONTH) 
            AND DATE_SUB(o2023.date_date, INTERVAL 1 DAY)
    WHERE EXTRACT(YEAR FROM o2023.date_date) = 2023
    GROUP BY o2023.orders_id, o2023.date_date, o2023.customers_id
)

SELECT 
    orders_id,
    date_date,
    CASE 
        WHEN previous_orders_12m = 0 THEN 'New'
        WHEN previous_orders_12m BETWEEN 1 AND 3 THEN 'Returning'
        WHEN previous_orders_12m >= 4 THEN 'VIP'
    END as segment
FROM customer_order_counts
ORDER BY date_date, orders_id;


[0m18:11:11.433094 [debug] [Thread-1 (]: On model.salesAnalysis.avg_prods_per_order_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.avg_prods_per_order_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`avg_prods_per_order_2023`
  OPTIONS()
  as WITH order_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        EXTRACT(MONTH FROM o.date_date) as month,
        COUNT(DISTINCT s.products_id) as products_count
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    month,
    ROUND(AVG(products_count), 2) as avg_products_per_order
FROM order_products
GROUP BY month
ORDER BY month;


[0m18:11:11.433520 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:11:11.433810 [debug] [Thread-4 (]: On model.salesAnalysis.orders_with_prods: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.orders_with_prods"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`orders_with_prods`
  OPTIONS()
  as WITH orders_with_products AS (
    SELECT 
        o.orders_id,
        o.date_date,
        COUNT(DISTINCT s.products_id) as qty_product
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) IN (2022, 2023)
    GROUP BY o.orders_id, o.date_date
)

SELECT 
    orders_id,
    date_date,
    qty_product
FROM orders_with_products
ORDER BY date_date, orders_id;


[0m18:11:11.434102 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:11:11.435124 [debug] [Thread-2 (]: On model.salesAnalysis.monthly_orders_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.monthly_orders_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`monthly_orders_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date,
        EXTRACT(MONTH FROM date_date) as month
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    month,
    COUNT(DISTINCT orders_id) as orders_count
FROM orders_2023 
GROUP BY month
ORDER BY month;


[0m18:11:11.435359 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:11:11.436787 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:11:12.124703 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:e2bfd217-a30e-44bf-97c5-a16a446365e1&page=queryresults
[0m18:11:12.232680 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:5a0d0fe9-d049-431e-8779-9fd800eca87b&page=queryresults
[0m18:11:12.236875 [debug] [Thread-3 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:cfcdb53e-fff3-48a7-9bf4-1b4ded4d3805&page=queryresults
[0m18:11:12.238374 [debug] [Thread-1 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:e8780818-6a37-4c90-bf8a-0e037e3bb585&page=queryresults
[0m18:11:12.760633 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c628a10>]}
[0m18:11:12.760895 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x30346ce50>]}
[0m18:11:12.761267 [info ] [Thread-4 (]: 4 of 6 OK created sql view model sales_analysis.orders_with_prods .............. [[32mCREATE VIEW (0 processed)[0m in 1.37s]
[0m18:11:12.761463 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x17c873990>]}
[0m18:11:12.761778 [info ] [Thread-2 (]: 2 of 6 OK created sql view model sales_analysis.monthly_orders_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.38s]
[0m18:11:12.761948 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16c8d7990>]}
[0m18:11:12.762219 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.orders_with_prods
[0m18:11:12.762541 [info ] [Thread-3 (]: 3 of 6 OK created sql view model sales_analysis.order_segments_2023 ............ [[32mCREATE VIEW (0 processed)[0m in 1.38s]
[0m18:11:12.762865 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.monthly_orders_2023
[0m18:11:12.763165 [info ] [Thread-1 (]: 1 of 6 OK created sql view model sales_analysis.avg_prods_per_order_2023 ....... [[32mCREATE VIEW (0 processed)[0m in 1.38s]
[0m18:11:12.763446 [debug] [Thread-4 (]: Began running node model.salesAnalysis.total_orders_2023
[0m18:11:12.763824 [debug] [Thread-3 (]: Finished running node model.salesAnalysis.order_segments_2023
[0m18:11:12.764141 [debug] [Thread-1 (]: Finished running node model.salesAnalysis.avg_prods_per_order_2023
[0m18:11:12.764385 [info ] [Thread-4 (]: 5 of 6 START sql view model sales_analysis.total_orders_2023 ................... [RUN]
[0m18:11:12.764703 [debug] [Thread-2 (]: Began running node model.salesAnalysis.2023_orders_with_segments
[0m18:11:12.764964 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.orders_with_prods, now model.salesAnalysis.total_orders_2023)
[0m18:11:12.765183 [info ] [Thread-2 (]: 6 of 6 START sql view model sales_analysis.2023_orders_with_segments ........... [RUN]
[0m18:11:12.765381 [debug] [Thread-4 (]: Began compiling node model.salesAnalysis.total_orders_2023
[0m18:11:12.765581 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.salesAnalysis.monthly_orders_2023, now model.salesAnalysis.2023_orders_with_segments)
[0m18:11:12.767388 [debug] [Thread-4 (]: Writing injected SQL for node "model.salesAnalysis.total_orders_2023"
[0m18:11:12.767667 [debug] [Thread-2 (]: Began compiling node model.salesAnalysis.2023_orders_with_segments
[0m18:11:12.769602 [debug] [Thread-2 (]: Writing injected SQL for node "model.salesAnalysis.2023_orders_with_segments"
[0m18:11:12.770173 [debug] [Thread-4 (]: Began executing node model.salesAnalysis.total_orders_2023
[0m18:11:12.771601 [debug] [Thread-4 (]: Writing runtime sql for node "model.salesAnalysis.total_orders_2023"
[0m18:11:12.772005 [debug] [Thread-2 (]: Began executing node model.salesAnalysis.2023_orders_with_segments
[0m18:11:12.773441 [debug] [Thread-2 (]: Writing runtime sql for node "model.salesAnalysis.2023_orders_with_segments"
[0m18:11:12.773819 [debug] [Thread-4 (]: On model.salesAnalysis.total_orders_2023: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.total_orders_2023"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`total_orders_2023`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        orders_id,
        date_date
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders`
    WHERE EXTRACT(YEAR FROM date_date) = 2023
)

SELECT 
    COUNT(DISTINCT orders_id) as total_orders_2023
FROM orders_2023;


[0m18:11:12.774115 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m18:11:12.774819 [debug] [Thread-2 (]: On model.salesAnalysis.2023_orders_with_segments: /* {"app": "dbt", "dbt_version": "1.9.2", "profile_name": "salesAnalysis", "target_name": "dev", "node_id": "model.salesAnalysis.2023_orders_with_segments"} */


  create or replace view `salesanalysis-450811`.`sales_analysis`.`2023_orders_with_segments`
  OPTIONS()
  as WITH orders_2023 AS (
    SELECT 
        o.orders_id,
        o.date_date,
        o.customers_id,
        COUNT(DISTINCT s.products_id) as qty_products
    FROM `salesanalysis-450811`.`salesAnalysis`.`orders` o
    LEFT JOIN `salesanalysis-450811`.`salesAnalysis`.`sales` s
        ON o.orders_id = s.order_id
    WHERE EXTRACT(YEAR FROM o.date_date) = 2023
    GROUP BY o.orders_id, o.date_date, o.customers_id
)

SELECT 
    o.orders_id,
    o.date_date,
    o.qty_products,
    seg.segment
FROM orders_2023 o
LEFT JOIN `salesanalysis-450811`.`sales_analysis`.`order_segments_2023` seg
    ON o.orders_id = seg.orders_id
ORDER BY o.date_date, o.orders_id;


[0m18:11:12.775142 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m18:11:13.661131 [debug] [Thread-4 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:5279efac-756a-499b-91e6-c72cabe5c40e&page=queryresults
[0m18:11:13.977748 [debug] [Thread-2 (]: BigQuery adapter: https://console.cloud.google.com/bigquery?project=salesanalysis-450811&j=bq:EU:4615e898-65d3-420b-8ab8-c58bfd3a01a4&page=queryresults
[0m18:11:14.100329 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x303422b50>]}
[0m18:11:14.101122 [info ] [Thread-4 (]: 5 of 6 OK created sql view model sales_analysis.total_orders_2023 .............. [[32mCREATE VIEW (0 processed)[0m in 1.34s]
[0m18:11:14.101663 [debug] [Thread-4 (]: Finished running node model.salesAnalysis.total_orders_2023
[0m18:11:14.504385 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f2b247ef-e7a3-4d9e-aa50-1a47c5943ea8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x16e0c0510>]}
[0m18:11:14.505326 [info ] [Thread-2 (]: 6 of 6 OK created sql view model sales_analysis.2023_orders_with_segments ...... [[32mCREATE VIEW (0 processed)[0m in 1.74s]
[0m18:11:14.506389 [debug] [Thread-2 (]: Finished running node model.salesAnalysis.2023_orders_with_segments
[0m18:11:14.508052 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m18:11:14.508620 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:11:14.508874 [debug] [MainThread]: Connection 'model.salesAnalysis.avg_prods_per_order_2023' was properly closed.
[0m18:11:14.509101 [debug] [MainThread]: Connection 'model.salesAnalysis.2023_orders_with_segments' was properly closed.
[0m18:11:14.509307 [debug] [MainThread]: Connection 'model.salesAnalysis.order_segments_2023' was properly closed.
[0m18:11:14.509522 [debug] [MainThread]: Connection 'model.salesAnalysis.total_orders_2023' was properly closed.
[0m18:11:14.509853 [info ] [MainThread]: 
[0m18:11:14.510134 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 6.71 seconds (6.71s).
[0m18:11:14.511185 [debug] [MainThread]: Command end result
[0m18:11:14.534361 [debug] [MainThread]: Wrote artifact WritableManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/manifest.json
[0m18:11:14.535891 [debug] [MainThread]: Wrote artifact SemanticManifest to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/semantic_manifest.json
[0m18:11:14.540258 [debug] [MainThread]: Wrote artifact RunExecutionResult to /Users/edou/Documents/Personal/Internships/Astrafy/TakeHomeAssignment/code/salesAnalysis/target/run_results.json
[0m18:11:14.540585 [info ] [MainThread]: 
[0m18:11:14.540896 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:11:14.541120 [info ] [MainThread]: 
[0m18:11:14.541316 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m18:11:14.541710 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 11.129541, "process_in_blocks": "0", "process_kernel_time": 2.518154, "process_mem_max_rss": "239255552", "process_out_blocks": "0", "process_user_time": 2.776097}
[0m18:11:14.542197 [debug] [MainThread]: Command `dbt run` succeeded at 18:11:14.542139 after 11.13 seconds
[0m18:11:14.542473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10254fcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10254fb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1024d1ad0>]}
[0m18:11:14.542715 [debug] [MainThread]: Flushing usage events
[0m18:11:15.889257 [debug] [MainThread]: An error was encountered while trying to flush usage events
